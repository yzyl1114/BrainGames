{"version":3,"sources":["file:///Users/huixu/Documents/GitHub/BrainGames/assets/games/chess/scripts/BoardController.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","UITransform","v3","Label","tween","UIOpacity","Sprite","Color","Peg","BOARD_SIZE","TILE_STATE","LEVELS_DATA","evaluateResult","CENTER_POS","ccclass","property","TILE_SIZE","BoardController","currentLevelIndex","boardState","activeNode","activePegRow","activePegCol","dragOffset","touchStartPos","pegNodes","Map","moveHistory","stepCount","undoCount","maxUndoCount","onLoad","console","log","PegPrefab","error","boardRoot","resultLabel","loadLevel","levelIndex","destroyAllChildren","clear","setMaxUndoCount","i","j","INVALID","length","string","stepCounterLabel","level","name","updateStepCounter","layout","r","c","PEG","spawnPeg","saveCurrentState","countPegs","warn","remainingUndo","showTips","message","duration","tipsLabel","isValid","node","active","opacity","getComponent","addComponent","to","delay","call","start","boardCopy","pegsInfo","push","row","col","shift","undoMove","pop","lastState","pegInfo","resetActiveState","remainingPegs","clearHistory","getPegLocalPosition","x","y","getLogicPosition","worldPos","boardUITransform","localPos","convertToNodeSpaceAR","Math","round","checkJumpValidity","r1","c1","r2","c2","EMPTY","dr","abs","dc","eatR","eatC","handlePegTouchStart","peg","event","setActive","touchUIPos","getUILocation","pegWorldPos","getWorldPosition","handlePegTouchMove","currentTouchPos","newWorldPos","setWorldPosition","safeUpdateFeedback","feedbackNode","targetLogicPos","eatenPos","setPosition","feedbackSprite","color","GREEN","RED","handlePegTouchEnd","currentWorldPos","executeJump","resetPegPosition","position","targetR","targetC","originalRow","originalCol","eatenKey","eatenNode","get","opacityComp","parallel","scale","destroy","delete","targetLocalPos","originalKey","newKey","set","checkGameState","findPegNode","key","count","isCenter","result","setTimeout","hasValidMove","foundCenterPeg","directions","nextLevel","retryLevel","pegNode","parent","uiTransform","setContentSize","pegComp","init"],"mappings":"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","sourcesContent":["// assets/games/chess/scripts/BoardController.ts\n\nimport { _decorator, Component, Node, Prefab, instantiate, UITransform, Vec3, v3, EventTouch, Label, tween, UIOpacity, Sprite, Color } from 'cc';\nimport { Peg } from './Peg';\nimport { BOARD_SIZE, TILE_STATE, LEVELS_DATA, evaluateResult, CENTER_POS } from './GameConfig'; \n\nconst { ccclass, property } = _decorator;\n\nconst TILE_SIZE = 90; \n\n@ccclass('BoardController')\nexport class BoardController extends Component {\n\n    @property(Prefab)\n    public PegPrefab: Prefab = null; \n    \n    @property(Node)\n    public boardRoot: Node = null; \n\n    @property(Node)\n    public feedbackNode: Node = null; // 反馈节点（可选）\n\n    @property(Label)\n    public resultLabel: Label = null; \n    \n    @property(Label)\n    public stepCounterLabel: Label = null; // 新增：计步器标签\n\n    @property(Label)\n    public tipsLabel: Label = null; // 新增：提示标签\n    \n    private currentLevelIndex: number = 0;\n    private boardState: number[][] = []; \n    private activeNode: Node | null = null; \n    private activePegRow: number = -1;\n    private activePegCol: number = -1;\n    private dragOffset: Vec3 = v3(0, 0, 0);\n    private touchStartPos: Vec3 = v3(0, 0, 0);\n    private pegNodes: Map<string, Node> = new Map(); // 使用Map存储棋子节点\n    \n    // 新增：历史记录和游戏状态\n    private moveHistory: Array<{\n        boardState: number[][];\n        pegsInfo: Array<{row: number, col: number}>;\n        stepCount: number;\n    }> = [];\n    private stepCount: number = 0; // 步数计数器\n    private undoCount: number = 0; // 悔棋次数计数器\n    private maxUndoCount: number = 5; // 最大悔棋次数（根据关卡动态调整）\n\n    protected onLoad() {\n        console.log(\"BoardController: onLoad start\");\n        \n        if (!this.PegPrefab) {\n            console.error(\"BoardController: PegPrefab is not assigned in the editor!\");\n            return;\n        }\n\n        if (!this.boardRoot) {\n            console.error(\"BoardController: boardRoot is not assigned in the editor!\");\n            return;\n        }\n        \n        if (!this.resultLabel) {\n            console.error(\"BoardController: resultLabel is not assigned in the editor!\");\n            return;\n        }\n\n        this.loadLevel(this.currentLevelIndex); \n    }\n    \n    public loadLevel(levelIndex: number) {\n        console.log(`Loading level ${levelIndex}`);\n        \n        if (!this.boardRoot || !this.resultLabel) {\n            console.error(\"Critical nodes missing, cannot load level\");\n            return;\n        }\n        \n        this.boardRoot.destroyAllChildren();\n        \n        this.activeNode = null;\n        this.activePegRow = -1;\n        this.activePegCol = -1;\n        this.pegNodes.clear();\n        \n        // 重置游戏状态\n        this.stepCount = 0;\n        this.undoCount = 0;\n        this.moveHistory = [];\n        \n        // 根据关卡设置最大悔棋次数\n        this.setMaxUndoCount(levelIndex);\n        \n        this.boardState = [];\n        for (let i = 0; i < BOARD_SIZE; i++) {\n            this.boardState[i] = [];\n            for (let j = 0; j < BOARD_SIZE; j++) {\n                this.boardState[i][j] = TILE_STATE.INVALID;\n            }\n        }\n\n        if (levelIndex >= LEVELS_DATA.length) {\n            this.resultLabel.string = \"所有关卡完成! 恭喜您！\";\n            if (this.stepCounterLabel) {\n                this.stepCounterLabel.string = \"\";\n            }\n            return;\n        }\n\n        const level = LEVELS_DATA[levelIndex];\n        this.resultLabel.string = `关卡 ${levelIndex + 1}: ${level.name}`;\n        \n        // 更新计步器显示\n        this.updateStepCounter();\n        \n        this.boardState = [];\n        for (let i = 0; i < level.layout.length; i++) {\n            this.boardState[i] = [...level.layout[i]];\n        }\n        \n        for (let r = 0; r < BOARD_SIZE; r++) {\n            for (let c = 0; c < BOARD_SIZE; c++) {\n                if (this.boardState[r][c] === TILE_STATE.PEG) {\n                    this.spawnPeg(r, c);\n                }\n            }\n        }\n        \n        // 保存初始状态\n        this.saveCurrentState();\n        \n        console.log(`Level ${levelIndex} loaded: ${level.name}, pegs count: ${this.countPegs()}, max undo: ${this.maxUndoCount}`);\n    }\n    \n    // 新增：根据关卡设置最大悔棋次数\n    private setMaxUndoCount(levelIndex: number) {\n        if (levelIndex < 30) {\n            this.maxUndoCount = 5; // 1-30关：5次\n        } else if (levelIndex < 60) {\n            this.maxUndoCount = 7; // 31-60关：7次\n        } else {\n            this.maxUndoCount = 9; // 61+关：9次\n        }\n    }\n    \n    // 新增：更新计步器显示\n    private updateStepCounter() {\n        if (!this.stepCounterLabel) {\n            console.warn(\"Step counter label not assigned\");\n            return;\n        }\n        \n        const remainingUndo = this.maxUndoCount - this.undoCount;\n        this.stepCounterLabel.string = `步数: ${this.stepCount} | 剩余悔棋: ${remainingUndo}次`;\n    }\n    \n    // 新增：显示临时提示\n    private showTips(message: string, duration: number = 2.0) {\n        if (!this.tipsLabel || !this.tipsLabel.isValid) {\n            console.log(\"Tips:\", message);\n            return;\n        }\n        \n        // 显示提示\n        this.tipsLabel.string = message;\n        this.tipsLabel.node.active = true;\n        \n        // 淡入效果\n        const opacity = this.tipsLabel.node.getComponent(UIOpacity) || this.tipsLabel.node.addComponent(UIOpacity);\n        opacity.opacity = 0;\n        \n        tween(opacity)\n            .to(0.3, { opacity: 255 })\n            .delay(duration)\n            .to(0.3, { opacity: 0 })\n            .call(() => {\n                this.tipsLabel.node.active = false;\n            })\n            .start();\n    }\n\n    // 新增：保存当前状态到历史记录\n    private saveCurrentState() {\n        // 深拷贝棋盘状态\n        const boardCopy: number[][] = [];\n        for (let i = 0; i < BOARD_SIZE; i++) {\n            boardCopy[i] = [...this.boardState[i]];\n        }\n        \n        // 收集所有棋子的位置信息\n        const pegsInfo: Array<{row: number, col: number}> = [];\n        for (let r = 0; r < BOARD_SIZE; r++) {\n            for (let c = 0; c < BOARD_SIZE; c++) {\n                if (this.boardState[r][c] === TILE_STATE.PEG) {\n                    pegsInfo.push({row: r, col: c});\n                }\n            }\n        }\n        \n        this.moveHistory.push({\n            boardState: boardCopy,\n            pegsInfo: pegsInfo,\n            stepCount: this.stepCount\n        });\n        \n        // 限制历史记录长度（防止内存占用过大）\n        if (this.moveHistory.length > 100) {\n            this.moveHistory.shift();\n        }\n        \n        console.log(`State saved. History size: ${this.moveHistory.length}, Step: ${this.stepCount}`);\n    }\n    \n    // 悔棋功能,修改undoMove方法，使用提示代替resultLabel\n    public undoMove() {\n        // 检查是否有历史记录\n        if (this.moveHistory.length <= 1) {\n            this.showTips(\"无法悔棋：已经是初始状态\");\n            return;\n        }\n        \n        // 检查悔棋次数是否用完\n        if (this.undoCount >= this.maxUndoCount) {\n            this.showTips(`悔棋次数已用完（最多${this.maxUndoCount}次）`);\n            return;\n        }\n        \n        // 弹出当前状态（不需要）\n        this.moveHistory.pop();\n        \n        // 获取上一步状态\n        const lastState = this.moveHistory[this.moveHistory.length - 1];\n        \n        // 恢复棋盘状态\n        for (let i = 0; i < BOARD_SIZE; i++) {\n            this.boardState[i] = [...lastState.boardState[i]];\n        }\n        \n        // 恢复步数\n        this.stepCount = lastState.stepCount;\n        \n        // 清空当前所有棋子\n        this.boardRoot.destroyAllChildren();\n        this.pegNodes.clear();\n        \n        // 重新生成棋子\n        for (const pegInfo of lastState.pegsInfo) {\n            this.spawnPeg(pegInfo.row, pegInfo.col);\n        }\n        \n        // 重置活动状态\n        this.resetActiveState();\n        \n        // 更新悔棋计数\n        this.undoCount++;\n        \n        // 更新计步器\n        this.updateStepCounter();\n        \n        const remainingPegs = this.countPegs();\n        const remainingUndo = this.maxUndoCount - this.undoCount;\n        \n        // 使用提示显示成功信息\n        this.showTips(`悔棋成功！剩余棋子: ${remainingPegs}，剩余悔棋: ${remainingUndo}次`);\n        \n        console.log(`Undo successful. Steps: ${this.stepCount}, Undo used: ${this.undoCount}/${this.maxUndoCount}, History: ${this.moveHistory.length}`);\n    }\n    \n    // 新增：清空历史记录\n    private clearHistory() {\n        this.moveHistory = [];\n        this.stepCount = 0;\n        this.undoCount = 0;\n        console.log(\"Move history cleared\");\n    }\n    \n    private getPegLocalPosition(r: number, c: number): Vec3 {\n        const x = (c - 3) * TILE_SIZE;\n        const y = (3 - r) * TILE_SIZE; \n        return v3(x, y, 0);\n    }\n\n    private getLogicPosition(worldPos: Vec3): { row: number, col: number } | null {\n        const boardUITransform = this.boardRoot.getComponent(UITransform);\n        if (!boardUITransform) {\n            console.warn(\"BoardRoot missing UITransform component\");\n            return null;\n        }\n        \n        const localPos = boardUITransform.convertToNodeSpaceAR(worldPos);\n        \n        const col = Math.round(localPos.x / TILE_SIZE) + 3;\n        const row = 3 - Math.round(localPos.y / TILE_SIZE);\n        \n        if (row >= 0 && row < BOARD_SIZE && col >= 0 && col < BOARD_SIZE) {\n            return { row, col };\n        }\n        return null;\n    }\n    \n    private checkJumpValidity(r1: number, c1: number, r2: number, c2: number): { row: number, col: number } | null {\n        if (r2 < 0 || r2 >= BOARD_SIZE || c2 < 0 || c2 >= BOARD_SIZE) return null;\n        if (this.boardState[r2][c2] === TILE_STATE.INVALID) return null;\n        if (this.boardState[r2][c2] !== TILE_STATE.EMPTY) return null;\n\n        const dr = Math.abs(r1 - r2);\n        const dc = Math.abs(c1 - c2);\n        if (!((dr === 2 && dc === 0) || (dr === 0 && dc === 2))) return null;\n        \n        const eatR = (r1 + r2) / 2;\n        const eatC = (c1 + c2) / 2;\n        \n        if (this.boardState[eatR][eatC] !== TILE_STATE.PEG) return null;\n        \n        console.log(`Valid jump from (${r1}, ${c1}) to (${r2}, ${c2}), eat (${eatR}, ${eatC})`);\n        return { row: eatR, col: eatC };\n    }\n    \n    // =================== 保持原有的拖拽逻辑 ===================\n    \n    public handlePegTouchStart(peg: Peg, event: EventTouch) {\n        console.log(`TouchStart: peg at (${peg.row}, ${peg.col})`);\n        \n        // 记录活动棋子\n        this.activeNode = peg.node;\n        this.activePegRow = peg.row;\n        this.activePegCol = peg.col;\n        \n        if (!this.activeNode || !this.activeNode.isValid) {\n            console.error(\"Peg node is invalid!\");\n            this.activeNode = null;\n            return;\n        }\n\n        // 激活棋子\n        peg.setActive(true);\n        \n        // 记录触摸起始位置\n        const touchUIPos = event.getUILocation();\n        this.touchStartPos = v3(touchUIPos.x, touchUIPos.y, 0);\n        \n        // 记录棋子当前位置\n        const pegWorldPos = this.activeNode.getWorldPosition();\n        this.dragOffset.x = pegWorldPos.x - this.touchStartPos.x;\n        this.dragOffset.y = pegWorldPos.y - this.touchStartPos.y;\n        \n        console.log(`TouchStart: touch (${this.touchStartPos.x}, ${this.touchStartPos.y}), offset (${this.dragOffset.x}, ${this.dragOffset.y})`);\n    }\n    \n    public handlePegTouchMove(peg: Peg, event: EventTouch) {\n        // 安全检查\n        if (!this.activeNode || !this.activeNode.isValid) {\n            console.warn(\"No active node in TouchMove\");\n            return;\n        }\n        \n        if (peg.row !== this.activePegRow || peg.col !== this.activePegCol) {\n            console.warn(\"Wrong peg in TouchMove\");\n            return;\n        }\n        \n        // 获取当前触摸位置\n        const touchUIPos = event.getUILocation();\n        const currentTouchPos = v3(touchUIPos.x, touchUIPos.y, 0);\n        \n        // 计算新的世界位置\n        const newWorldPos = v3(\n            currentTouchPos.x + this.dragOffset.x,\n            currentTouchPos.y + this.dragOffset.y,\n            0\n        );\n        \n        console.log(`TouchMove: current (${currentTouchPos.x}, ${currentTouchPos.y}), new world (${newWorldPos.x}, ${newWorldPos.y})`);\n        \n        // 直接设置世界位置\n        this.activeNode.setWorldPosition(newWorldPos);\n        \n        // 安全地更新反馈（如果feedbackNode存在）\n        this.safeUpdateFeedback(newWorldPos);\n    }\n    \n    private safeUpdateFeedback(worldPos: Vec3) {\n        // 安全检查：如果feedbackNode不存在或无效，直接返回\n        if (!this.feedbackNode || !this.feedbackNode.isValid) {\n            return;\n        }\n        \n        const targetLogicPos = this.getLogicPosition(worldPos);\n        \n        // 先隐藏反馈节点\n        this.feedbackNode.active = false;\n        \n        if (targetLogicPos) {\n            const eatenPos = this.checkJumpValidity(\n                this.activePegRow, \n                this.activePegCol, \n                targetLogicPos.row, \n                targetLogicPos.col\n            );\n            \n            if (eatenPos) {\n                // 显示绿色反馈（有效跳吃）\n                this.feedbackNode.active = true;\n                this.feedbackNode.setPosition(this.getPegLocalPosition(targetLogicPos.row, targetLogicPos.col));\n                \n                const feedbackSprite = this.feedbackNode.getComponent(Sprite);\n                if (feedbackSprite) {\n                    feedbackSprite.color = Color.GREEN;\n                }\n            } else {\n                // 显示红色反馈（无效位置）\n                this.feedbackNode.active = true;\n                this.feedbackNode.setPosition(this.getPegLocalPosition(targetLogicPos.row, targetLogicPos.col));\n                \n                const feedbackSprite = this.feedbackNode.getComponent(Sprite);\n                if (feedbackSprite) {\n                    feedbackSprite.color = Color.RED;\n                }\n            }\n        }\n    }\n    \n    public handlePegTouchEnd(peg: Peg, event: EventTouch) {\n        console.log(`TouchEnd: peg at (${peg.row}, ${peg.col})`);\n        \n        if (!this.activeNode || !this.activeNode.isValid) {\n            console.warn(\"No active node in TouchEnd\");\n            return;\n        }\n        \n        if (peg.row !== this.activePegRow || peg.col !== this.activePegCol) {\n            console.warn(\"Wrong peg in TouchEnd\");\n            this.resetActiveState();\n            return;\n        }\n        \n        // 安全地隐藏反馈节点\n        if (this.feedbackNode && this.feedbackNode.isValid) {\n            this.feedbackNode.active = false;\n        }\n        \n        // 获取当前位置\n        const currentWorldPos = this.activeNode.getWorldPosition();\n        const targetLogicPos = this.getLogicPosition(currentWorldPos);\n        \n        console.log(`TouchEnd: world pos (${currentWorldPos.x}, ${currentWorldPos.y}), target ${targetLogicPos ? `(${targetLogicPos.row}, ${targetLogicPos.col})` : 'null'}`);\n        \n        // 1. 尝试跳吃\n        if (targetLogicPos) {\n            const eatenPos = this.checkJumpValidity(\n                this.activePegRow, \n                this.activePegCol, \n                targetLogicPos.row, \n                targetLogicPos.col\n            );\n            \n            if (eatenPos) {\n                console.log(`Valid jump detected, executing...`);\n                this.executeJump(peg, targetLogicPos.row, targetLogicPos.col, eatenPos);\n                return; \n            }\n        }\n        \n        // 2. 无效跳吃：棋子归位\n        console.log(`Invalid jump or out of board, resetting peg position`);\n        this.resetPegPosition(peg);\n    }\n    \n    private resetPegPosition(peg: Peg) {\n        if (!this.activeNode) return;\n        \n        peg.setActive(false);\n        \n        tween(this.activeNode)\n            .to(0.1, { position: this.getPegLocalPosition(this.activePegRow, this.activePegCol) })\n            .call(() => {\n                console.log(`Peg reset to original position (${this.activePegRow}, ${this.activePegCol})`);\n                this.resetActiveState();\n            })\n            .start();\n    }\n    \n    private resetActiveState() {\n        this.activeNode = null;\n        this.activePegRow = -1;\n        this.activePegCol = -1;\n    }\n    \n    private executeJump(peg: Peg, targetR: number, targetC: number, eatenPos: { row: number, col: number }) {\n        console.log(`Executing jump: peg (${this.activePegRow}, ${this.activePegCol}) -> (${targetR}, ${targetC}), eat (${eatenPos.row}, ${eatenPos.col})`);\n        \n        if (!this.activeNode || !this.activeNode.isValid) {\n            console.error(\"Invalid node in executeJump\");\n            return;\n        }\n        \n        // 保存当前状态到历史记录（在跳吃之前）\n        this.saveCurrentState();\n        \n        peg.setActive(false);\n        \n        const originalRow = this.activePegRow;\n        const originalCol = this.activePegCol;\n        \n        // 更新棋盘状态：清空起点\n        this.boardState[originalRow][originalCol] = TILE_STATE.EMPTY;\n        \n        // 找到并移除被吃的棋子\n        const eatenKey = `${eatenPos.row},${eatenPos.col}`;\n        const eatenNode = this.pegNodes.get(eatenKey);\n        \n        if (eatenNode && eatenNode.isValid) {\n            console.log(`Removing eaten peg at (${eatenPos.row}, ${eatenPos.col})`);\n            \n            const opacityComp = eatenNode.getComponent(UIOpacity) || eatenNode.addComponent(UIOpacity);\n            \n            tween(eatenNode)  // 这里加上eatenNode\n                .parallel(\n                    tween().to(0.15, { scale: v3(0.1, 0.1, 0.1) }),  // 这里去掉eatenNode\n                    tween(opacityComp).to(0.15, { opacity: 0 })\n                )            \n                .call(() => {\n                    eatenNode.destroy();\n                    this.pegNodes.delete(eatenKey);\n                    this.boardState[eatenPos.row][eatenPos.col] = TILE_STATE.EMPTY;\n                })\n                .start();\n        } else {\n            console.warn(`Eaten peg node not found at (${eatenPos.row}, ${eatenPos.col})`);\n            this.boardState[eatenPos.row][eatenPos.col] = TILE_STATE.EMPTY;\n        }\n        \n        // 移动棋子到目标位置\n        const targetLocalPos = this.getPegLocalPosition(targetR, targetC);\n        \n        console.log(`Moving peg from (${originalRow}, ${originalCol}) to (${targetR}, ${targetC})`);\n        \n        tween(this.activeNode)\n            .to(0.2, { position: targetLocalPos })\n            .call(() => {\n                // 更新棋盘状态：设置终点\n                this.boardState[targetR][targetC] = TILE_STATE.PEG;\n                \n                // 更新棋子逻辑坐标\n                peg.row = targetR;\n                peg.col = targetC;\n                \n                // 更新节点Map\n                const originalKey = `${originalRow},${originalCol}`;\n                const newKey = `${targetR},${targetC}`;\n                this.pegNodes.delete(originalKey);\n                this.pegNodes.set(newKey, this.activeNode);\n                \n                // 增加步数\n                this.stepCount++;\n                \n                // 更新计步器\n                this.updateStepCounter();\n                \n                console.log(`Jump completed. Step: ${this.stepCount}, Board updated.`);\n                this.resetActiveState();\n                this.checkGameState();\n            })\n            .start();\n    }\n    \n    private findPegNode(row: number, col: number): Node | null {\n        const key = `${row},${col}`;\n        return this.pegNodes.get(key) || null;\n    }\n    \n    private countPegs(): number {\n        let count = 0;\n        for (let r = 0; r < BOARD_SIZE; r++) {\n            for (let c = 0; c < BOARD_SIZE; c++) {\n                if (this.boardState[r][c] === TILE_STATE.PEG) {\n                    count++;\n                }\n            }\n        }\n        return count;\n    }\n    \n    private checkGameState() {\n        let remainingPegs = 0;\n        for (let r = 0; r < BOARD_SIZE; r++) {\n            for (let c = 0; c < BOARD_SIZE; c++) {\n                if (this.boardState[r][c] === TILE_STATE.PEG) {\n                    remainingPegs++;\n                }\n            }\n        }\n        \n        console.log(`Game state check: ${remainingPegs} pegs remaining`);\n        \n        if (remainingPegs === 1) {\n            const isCenter = this.boardState[CENTER_POS.row][CENTER_POS.col] === TILE_STATE.PEG;\n            const result = evaluateResult(remainingPegs, isCenter);\n            this.resultLabel.string = `恭喜! 剩余 ${remainingPegs} 颗. 评价: ${result}. 步数: ${this.stepCount}`;\n            \n            console.log(`Victory! Remaining pegs: ${remainingPegs}, center: ${isCenter}, result: ${result}, steps: ${this.stepCount}`);\n            \n            setTimeout(() => {\n                this.currentLevelIndex++;\n                this.loadLevel(this.currentLevelIndex); \n            }, 3000);\n            return;\n        }\n\n        if (remainingPegs > 1 && !this.hasValidMove()) {\n            console.log(\"No valid moves remaining\");\n            \n            let foundCenterPeg = false;\n            if (this.boardState[CENTER_POS.row][CENTER_POS.col] === TILE_STATE.PEG) {\n                foundCenterPeg = true;\n            }\n\n            const result = evaluateResult(remainingPegs, foundCenterPeg);\n            this.resultLabel.string = `游戏结束! 剩余 ${remainingPegs} 颗. 评价: ${result}. 步数: ${this.stepCount}`;\n        }\n    }\n    \n    private hasValidMove(): boolean {\n        const directions = [[0, 2], [0, -2], [2, 0], [-2, 0]]; \n        \n        for (let r1 = 0; r1 < BOARD_SIZE; r1++) {\n            for (let c1 = 0; c1 < BOARD_SIZE; c1++) {\n                if (this.boardState[r1][c1] === TILE_STATE.PEG) {\n                    for (const [dr, dc] of directions) {\n                        const r2 = r1 + dr;\n                        const c2 = c1 + dc;\n                        \n                        if (this.checkJumpValidity(r1, c1, r2, c2)) {\n                            console.log(`Found valid move from (${r1}, ${c1}) to (${r2}, ${c2})`);\n                            return true; \n                        }\n                    }\n                }\n            }\n        }\n        return false; \n    }\n    \n    public nextLevel() {\n        console.log(\"Loading next level\");\n        this.currentLevelIndex++;\n        this.loadLevel(this.currentLevelIndex);\n    }\n    \n    // 修改：重玩功能\n    public retryLevel() {\n        console.log(\"Retrying current level\");\n        this.clearHistory();  // 清空历史记录\n        this.loadLevel(this.currentLevelIndex);\n    }\n    \n    private spawnPeg(r: number, c: number) {\n        if (!this.PegPrefab) {\n            console.error(\"Cannot spawn peg: PegPrefab is null\");\n            return;\n        }\n        \n        const pegNode = instantiate(this.PegPrefab);\n        pegNode.parent = this.boardRoot;\n        \n        const uiTransform = pegNode.getComponent(UITransform);\n        if (uiTransform) {\n            uiTransform.setContentSize(TILE_SIZE, TILE_SIZE);\n        }\n        \n        const pegComp = pegNode.getComponent(Peg);\n        if (!pegComp) {\n            console.error(\"Peg Prefab missing Peg component!\");\n            pegNode.destroy();\n            return;\n        }\n        \n        pegComp.init(r, c, this);\n        \n        pegNode.setPosition(this.getPegLocalPosition(r, c));\n        \n        // 保存节点到Map\n        const key = `${r},${c}`;\n        this.pegNodes.set(key, pegNode);\n        \n        console.log(`Spawned peg at (${r}, ${c})`);\n    }\n}"]}