{"version":3,"sources":["file:///Users/huixu/BrainGames/assets/games/chess/scripts/Peg.ts"],"names":["_decorator","Component","Node","Sprite","Color","UITransform","ccclass","property","Peg","row","col","boardController","isActive","onLoad","pegGraphic","console","error","getComponent","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onTouchCancel","log","init","controller","setActive","active","sprite","color","YELLOW","WHITE","event","handlePegTouchStart","handlePegTouchMove","handlePegTouchEnd"],"mappings":"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","sourcesContent":["// assets/games/chess/scripts/Peg.ts\n\nimport { _decorator, Component, Node, Sprite, Color, UITransform, EventTouch } from 'cc';\nimport { BoardController } from './BoardController';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('Peg')\nexport class Peg extends Component {\n    // 逻辑坐标\n    public row: number = -1;\n    public col: number = -1;\n    \n    // 引用主控制器，用于将输入转发给它\n    private boardController: BoardController = null;\n    \n    // 棋子本体（Sprite组件所在节点，用于切换外观）\n    @property(Node)\n    public pegGraphic: Node = null;\n\n    // 棋子激活状态的视觉反馈\n    private isActive: boolean = false;\n    \n    onLoad() {\n        if (!this.pegGraphic) {\n            console.error(\"Peg component requires pegGraphic node reference.\");\n        }\n        \n        // 【关键修复1】确保有UITransform组件来接收输入\n        if (!this.getComponent(UITransform)) {\n            console.error(\"Peg Node is missing UITransform for input detection!\");\n        }\n        \n        // 【关键修复2】完整注册所有触摸事件\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\n        this.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\n        \n        console.log(`Peg: Event listeners registered for node at (${this.row}, ${this.col})`);\n    }\n    \n    /**\n     * 初始化棋子逻辑坐标和控制器引用\n     */\n    public init(row: number, col: number, controller: BoardController) {\n        this.row = row;\n        this.col = col;\n        this.boardController = controller;\n        console.log(`Peg: Initialized at (${row}, ${col})`);\n    }\n\n    /**\n     * 设置激活/非激活状态（用于选中状态）\n     * @param active 是否激活\n     */\n    public setActive(active: boolean) {\n        this.isActive = active;\n        \n        if (this.pegGraphic) {\n             const sprite = this.pegGraphic.getComponent(Sprite);\n             if (sprite) {\n                 // 视觉效果：激活时变黄，非激活时恢复白色\n                 sprite.color = active ? Color.YELLOW : Color.WHITE; \n             }\n        }\n    }\n    \n    // ================== 交互处理：转发给 BoardController ==================\n    \n    private onTouchStart(event: EventTouch) {\n        console.log(`Peg ${this.row}, ${this.col} Touch Start!`);\n\n        if (this.boardController) {\n            this.boardController.handlePegTouchStart(this, event);\n        }\n    }\n    \n    private onTouchMove(event: EventTouch) {\n        console.log(`Peg ${this.row}, ${this.col} Touch Move!`);\n        \n        if (this.boardController) {\n            this.boardController.handlePegTouchMove(this, event);\n        }\n    }\n    \n    private onTouchEnd(event: EventTouch) {\n        console.log(`Peg ${this.row}, ${this.col} Touch End!`);\n        \n        if (this.boardController) {\n            this.boardController.handlePegTouchEnd(this, event);\n        }\n    }\n    \n    private onTouchCancel(event: EventTouch) {\n        console.log(`Peg ${this.row}, ${this.col} Touch Cancel!`);\n        this.onTouchEnd(event);\n    }\n}"]}