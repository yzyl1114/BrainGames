{"version":3,"sources":["file:///Applications/Cocos/Creator/3.8.8/CocosCreator.app/Contents/Resources/resources/3d/engine/editor/assets/default_renderpipeline/builtin-pipeline.ts"],"names":["PipelineConfigs","CameraConfigs","ForwardLighting","BuiltinForwardPassBuilder","BuiltinBloomPassBuilder","BuiltinToneMappingPassBuilder","BuiltinFXAAPassBuilder","BuiltinFsrPassBuilder","BuiltinUiPassBuilder","forwardNeedClearColor","camera","clearFlag","ClearFlagBit","COLOR","STENCIL","getCsmMainLightViewport","light","w","h","level","vp","screenSpaceSignY","shadowFixedArea","csmLevel","CSMLevel","LEVEL_1","left","top","width","Math","trunc","height","floor","max","setupPipelineConfigs","ppl","configs","sampleFeature","FormatFeatureBit","SAMPLED_TEXTURE","LINEAR_FILTER","device","isWeb","sys","isNative","isWebGL1","gfxAPI","gfx","API","WEBGL","isWebGL2","WEBGL2","isWebGPU","WEBGPU","isMobile","isHDR","pipelineSceneData","useFloatOutput","getMacroBool","toneMappingType","postSettings","shadowInfo","shadows","shadowEnabled","enabled","shadowMapFormat","pipeline","supportsR32FloatTexture","Format","R32F","RGBA8","shadowMapSize","set","size","usePlanarShadow","type","renderer","scene","ShadowType","Planar","capabilities","supportDepthSample","getFormatFeatures","DEPTH_STENCIL","platform","x","clipSpaceSignY","sortPipelinePassBuildersByConfigOrder","passBuilders","sort","a","b","getConfigOrder","sortPipelinePassBuildersByRenderOrder","getRenderOrder","addCopyToScreenPass","pplConfigs","cameraConfigs","input","assert","copyAndTonemapMaterial","pass","addRenderPass","nativeWidth","nativeHeight","addRenderTarget","colorName","LoadOp","CLEAR","StoreOp","STORE","sClearColorTransparentBlack","addTexture","addQueue","rendering","QueueHint","OPAQUE","addFullscreenQuad","getPingPongRenderTarget","prevName","prefix","id","startsWith","Number","charAt","length","downSize","scale","cclegacy","clamp","geometry","Layers","Material","PipelineEventType","Vec2","Vec3","Vec4","warn","macro","DEBUG","EDITOR","BloomType","makePipelineSettings","AABB","Sphere","intersect","Color","TextureType","Viewport","CameraUsage","LightType","mobileMaxSpotLightShadowMaps","defaultSettings","settings","isMainGameWindow","renderWindowId","depthStencilName","enableFullPipeline","enableProfiler","remainingPasses","enableShadingScale","shadingScale","enableHDR","radianceFormat","enableStoreSceneDepth","lights","shadowEnabledSpotLights","_sphere","create","_boundingBox","_rangedDirLightBoundingBox","cullLights","frustum","cameraPos","spotLights","baked","position","y","z","range","sphereFrustum","push","sphereLights","pointLights","rangedDirLights","transform","node","getWorldMatrix","aabbFrustum","lhs","rhs","squaredDistance","_addLightQueues","queue","BLEND","SPHERE","name","SPOT","POINT","RANGED_DIRECTIONAL","addScene","SceneFlags","addSpotlightShadowPasses","maxNumShadowMaps","i","shadowPass","addDepthStencil","DISCARD","NONE","MASK","SHADOW_CASTER","useLightFrustum","addLightQueues","addLightPasses","depthStencilStoreOp","viewport","count","storeOp","setViewport","LOAD","isMultipleLightPassesNeeded","forwardLighting","_viewport","_clearColor","_reflectionProbeClearColor","ConfigOrder","RenderOrder","configCamera","pipelineConfigs","enableMainLightShadowMap","mainLight","enableMainLightPlanarShadowMap","enablePlanarReflectionProbe","cameraUsage","SCENE_VIEW","GAME_VIEW","enableMSAA","msaa","ENABLE_WEBGL_ANTIALIAS","ENABLE_TRANSPARENT_CANVAS","enableSingleForwardPass","windowResize","window","ResourceFlags","ResourceResidency","TEX2D","sampleCount","COLOR_ATTACHMENT","MEMORYLESS","DEPTH_STENCIL_ATTACHMENT","setup","context","setVec4","_addCascadedShadowMapPass","_tryAddReflectionProbePasses","_addForwardRadiancePasses","shadowSize","csmSupported","reflectionProbeManager","internal","probes","getProbes","maxProbeCount","probeID","probe","needRender","area","renderArea","probeType","ProbeType","PLANAR","realtimePlanarTexture","addRenderWindow","probePass","_buildReflectionProbePass","faceIdx","bakedCubeTextures","updateCameraDir","colorStoreOp","clearColor","packRGBE","clearDepth","clearStencil","REFLECTION_PROBE","undefined","disableMSAA","round","_addForwardSingleRadiancePass","_addForwardMultipleRadiancePasses","_addPlanarShadowQueue","sceneFlags","geometryRenderer","GEOMETRY","msaaRadianceName","msaaDepthStencilName","msPass","addMultisampleRenderPass","_buildForwardMainLightPass","resolveRenderTarget","firstStoreOp","PLANAR_SHADOW","_clearColorTransparentBlack","_bloomParams","_bloomTexSize","_bloomWidths","_bloomHeights","_bloomTexNames","_bloomUpSampleTexDescs","_bloomDownSampleTexDescs","_prefilterTexDesc","_originalColorDesc","bloom","hasValidMaterial","KawaseDualFilter","kawaseFilterMaterial","MipmapFilter","mipmapFilterMaterial","enableBloom","format","bloomWidth","bloomHeight","iterations","pow","createTexture","desc","prevRenderPass","material","_addKawaseDualFilterBloomPasses","_addMipmapFilterBloomPasses","bloomMaterial","radianceName","sizeCount","threshold","enableAlphaMask","prefilterPass","downPass","upPass","intensity","combinePass","_addPass","layout","passIndex","loadOp","queueHint","prefilterInfo","currSamplePass","downSampleInfos","currInfo","samplerSrc","samplerSrcName","lastIndex","upSampleInfos","sampleSrc","sampleSrcName","_colorGradingTexSize","enableColorGrading","colorGrading","colorGradingMap","enableToneMapping","setProperty","_addCopyAndTonemapPass","ldrColorPrefix","ldrColorName","lutTex","isSquareMap","setVec2","setFloat","contribute","toneMapping","_fxaaParams","enableFXAA","fxaa","_addFxaaPass","inputColorName","lastPass","fxaaMaterial","_fsrParams","_fsrTexSize","enableFSR","fsr","outputColorName","_addFsrPass","fsrMaterial","sharpness","uiColorPrefix","fsrColorName","easuPass","rcasPass","flags","UI","PROFILER","showStatistics","BuiltinPipelineBuilder","_pipelineEvent","director","root","pipelineEvent","_forwardPass","_bloomPass","_toneMappingPass","_fxaaPass","_fsrPass","_uiPass","_configs","_cameraConfigs","_copyAndTonemapMaterial","_initialized","_passBuilders","_setupPipelinePreview","isEditorView","PREVIEW","editorSettings","getEditorPipelineSettings","pipelineSettings","_preparePipelinePasses","_passes","_setupBuiltinCameraConfigs","GAME","swapchain","isGameView","visibility","Enum","DEFAULT","profiler","RGBA16F","_setupCameraConfigs","builder","cameras","_initMaterials","emit","RENDER_CAMERA_BEGIN","_buildForwardPipeline","_buildSimplePipeline","RENDER_CAMERA_END","_uuid","initialize","effectName","effectAsset","setCustomPipeline"],"mappings":"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","sourcesContent":["/*\n Copyright (c) 2021-2024 Xiamen Yaji Software Co., Ltd.\n\n https://www.cocos.com/\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights to\n use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n of the Software, and to permit persons to whom the Software is furnished to do so,\n subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in\n all copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n THE SOFTWARE.\n*/\n\nimport {\n    assert, cclegacy, clamp, geometry, gfx, Layers, Material, pipeline,\n    PipelineEventProcessor, PipelineEventType, ReflectionProbeManager, renderer,\n    rendering, sys, Vec2, Vec3, Vec4, warn, macro,\n} from 'cc';\n\nimport { DEBUG, EDITOR } from 'cc/env';\n\nimport {\n    BloomType,\n    makePipelineSettings,\n    PipelineSettings,\n} from './builtin-pipeline-types';\n\nconst { AABB, Sphere, intersect } = geometry;\nconst { ClearFlagBit, Color, Format, FormatFeatureBit, LoadOp, StoreOp, TextureType, Viewport } = gfx;\nconst { scene } = renderer;\nconst { CameraUsage, CSMLevel, LightType } = scene;\n\nfunction forwardNeedClearColor(camera: renderer.scene.Camera): boolean {\n    return !!(camera.clearFlag & (ClearFlagBit.COLOR | (ClearFlagBit.STENCIL << 1)));\n}\n\nfunction getCsmMainLightViewport(\n    light: renderer.scene.DirectionalLight,\n    w: number,\n    h: number,\n    level: number,\n    vp: gfx.Viewport,\n    screenSpaceSignY: number,\n): void {\n    if (light.shadowFixedArea || light.csmLevel === CSMLevel.LEVEL_1) {\n        vp.left = 0;\n        vp.top = 0;\n        vp.width = Math.trunc(w);\n        vp.height = Math.trunc(h);\n    } else {\n        vp.left = Math.trunc(level % 2 * 0.5 * w);\n        if (screenSpaceSignY > 0) {\n            vp.top = Math.trunc((1 - Math.floor(level / 2)) * 0.5 * h);\n        } else {\n            vp.top = Math.trunc(Math.floor(level / 2) * 0.5 * h);\n        }\n        vp.width = Math.trunc(0.5 * w);\n        vp.height = Math.trunc(0.5 * h);\n    }\n    vp.left = Math.max(0, vp.left);\n    vp.top = Math.max(0, vp.top);\n    vp.width = Math.max(1, vp.width);\n    vp.height = Math.max(1, vp.height);\n}\n\nexport class PipelineConfigs {\n    isWeb = false;\n    isWebGL1 = false;\n    isWebGL2 = false;\n    isWebGPU = false;\n    isMobile = false;\n    isHDR = false;\n    useFloatOutput = false;\n    toneMappingType = 0; // 0: ACES, 1: None\n    shadowEnabled = false;\n    shadowMapFormat = Format.R32F;\n    shadowMapSize = new Vec2(1, 1);\n    usePlanarShadow = false;\n    screenSpaceSignY = 1;\n    supportDepthSample = false;\n    mobileMaxSpotLightShadowMaps = 1;\n\n    platform = new Vec4(0, 0, 0, 0);\n}\n\nfunction setupPipelineConfigs(\n    ppl: rendering.BasicPipeline,\n    configs: PipelineConfigs,\n): void {\n    const sampleFeature = FormatFeatureBit.SAMPLED_TEXTURE | FormatFeatureBit.LINEAR_FILTER;\n    const device = ppl.device;\n    // Platform\n    configs.isWeb = !sys.isNative;\n    configs.isWebGL1 = device.gfxAPI === gfx.API.WEBGL;\n    configs.isWebGL2 = device.gfxAPI === gfx.API.WEBGL2;\n    configs.isWebGPU = device.gfxAPI === gfx.API.WEBGPU;\n    configs.isMobile = sys.isMobile;\n\n    // Rendering\n    configs.isHDR = ppl.pipelineSceneData.isHDR; // Has tone mapping\n    configs.useFloatOutput = ppl.getMacroBool('CC_USE_FLOAT_OUTPUT');\n    configs.toneMappingType = ppl.pipelineSceneData.postSettings.toneMappingType;\n    // Shadow\n    const shadowInfo = ppl.pipelineSceneData.shadows;\n    configs.shadowEnabled = shadowInfo.enabled;\n    configs.shadowMapFormat = pipeline.supportsR32FloatTexture(ppl.device) ? Format.R32F : Format.RGBA8;\n    configs.shadowMapSize.set(shadowInfo.size);\n    configs.usePlanarShadow = shadowInfo.enabled && shadowInfo.type === renderer.scene.ShadowType.Planar;\n    // Device\n    configs.screenSpaceSignY = ppl.device.capabilities.screenSpaceSignY;\n    configs.supportDepthSample = (ppl.device.getFormatFeatures(Format.DEPTH_STENCIL) & sampleFeature) === sampleFeature;\n    // Constants\n    const screenSpaceSignY = device.capabilities.screenSpaceSignY;\n    configs.platform.x = configs.isMobile ? 1.0 : 0.0;\n    configs.platform.w = (screenSpaceSignY * 0.5 + 0.5) << 1 | (device.capabilities.clipSpaceSignY * 0.5 + 0.5);\n}\n\nexport interface PipelineSettings2 extends PipelineSettings {\n    _passes?: rendering.PipelinePassBuilder[];\n}\n\nconst defaultSettings = makePipelineSettings();\n\nexport class CameraConfigs {\n    settings: PipelineSettings = defaultSettings;\n    // Window\n    isMainGameWindow = false;\n    renderWindowId = 0;\n    // Camera\n    colorName = '';\n    depthStencilName = '';\n    // Pipeline\n    enableFullPipeline = false;\n    enableProfiler = false;\n    remainingPasses = 0;\n    // Shading Scale\n    enableShadingScale = false;\n    shadingScale = 1.0;\n    nativeWidth = 1;\n    nativeHeight = 1;\n    width = 1; // Scaled width\n    height = 1; // Scaled height\n    // Radiance\n    enableHDR = false;\n    radianceFormat = gfx.Format.RGBA8;\n    // Tone Mapping\n    copyAndTonemapMaterial: Material | null = null;\n    // Depth\n    /** @en mutable */\n    enableStoreSceneDepth = false;\n}\n\nconst sClearColorTransparentBlack = new Color(0, 0, 0, 0);\n\nfunction sortPipelinePassBuildersByConfigOrder(passBuilders: rendering.PipelinePassBuilder[]): void {\n    passBuilders.sort((a, b) => {\n        return a.getConfigOrder() - b.getConfigOrder();\n    });\n}\n\nfunction sortPipelinePassBuildersByRenderOrder(passBuilders: rendering.PipelinePassBuilder[]): void {\n    passBuilders.sort((a, b) => {\n        return a.getRenderOrder() - b.getRenderOrder();\n    });\n}\n\nfunction addCopyToScreenPass(\n    ppl: rendering.BasicPipeline,\n    pplConfigs: Readonly<PipelineConfigs>,\n    cameraConfigs: CameraConfigs,\n    input: string,\n): rendering.BasicRenderPassBuilder {\n    assert(!!cameraConfigs.copyAndTonemapMaterial);\n    const pass = ppl.addRenderPass(\n        cameraConfigs.nativeWidth,\n        cameraConfigs.nativeHeight,\n        'cc-tone-mapping');\n    pass.addRenderTarget(\n        cameraConfigs.colorName,\n        LoadOp.CLEAR, StoreOp.STORE,\n        sClearColorTransparentBlack);\n    pass.addTexture(input, 'inputTexture');\n    pass.addQueue(rendering.QueueHint.OPAQUE)\n        .addFullscreenQuad(cameraConfigs.copyAndTonemapMaterial, 1);\n    return pass;\n}\n\nexport function getPingPongRenderTarget(prevName: string, prefix: string, id: number): string {\n    if (prevName.startsWith(prefix)) {\n        return `${prefix}${1 - Number(prevName.charAt(prefix.length))}_${id}`;\n    } else {\n        return `${prefix}0_${id}`;\n    }\n}\n\nexport interface PipelineContext {\n    colorName: string;\n    depthStencilName: string;\n}\n\nclass ForwardLighting {\n    // Active lights\n    private readonly lights: renderer.scene.Light[] = [];\n    // Active spot lights with shadows (Mutually exclusive with `lights`)\n    private readonly shadowEnabledSpotLights: renderer.scene.SpotLight[] = [];\n\n    // Internal cached resources\n    private readonly _sphere = Sphere.create(0, 0, 0, 1);\n    private readonly _boundingBox = new AABB();\n    private readonly _rangedDirLightBoundingBox = new AABB(0.0, 0.0, 0.0, 0.5, 0.5, 0.5);\n\n    // ----------------------------------------------------------------\n    // Interface\n    // ----------------------------------------------------------------\n    public cullLights(scene: renderer.RenderScene, frustum: geometry.Frustum, cameraPos?: Vec3): void {\n        // TODO(zhouzhenglong): Make light culling native\n        this.lights.length = 0;\n        this.shadowEnabledSpotLights.length = 0;\n        // spot lights\n        for (const light of scene.spotLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                if (light.shadowEnabled) {\n                    this.shadowEnabledSpotLights.push(light);\n                } else {\n                    this.lights.push(light);\n                }\n            }\n        }\n        // sphere lights\n        for (const light of scene.sphereLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                this.lights.push(light);\n            }\n        }\n        // point lights\n        for (const light of scene.pointLights) {\n            if (light.baked) {\n                continue;\n            }\n            Sphere.set(this._sphere, light.position.x, light.position.y, light.position.z, light.range);\n            if (intersect.sphereFrustum(this._sphere, frustum)) {\n                this.lights.push(light);\n            }\n        }\n        // ranged dir lights\n        for (const light of scene.rangedDirLights) {\n            AABB.transform(this._boundingBox, this._rangedDirLightBoundingBox, light.node!.getWorldMatrix());\n            if (intersect.aabbFrustum(this._boundingBox, frustum)) {\n                this.lights.push(light);\n            }\n        }\n\n        if (cameraPos) {\n            this.shadowEnabledSpotLights.sort(\n                (lhs, rhs) => Vec3.squaredDistance(cameraPos, lhs.position) - Vec3.squaredDistance(cameraPos, rhs.position),\n            );\n        }\n    }\n    private _addLightQueues(camera: renderer.scene.Camera, pass: rendering.BasicRenderPassBuilder): void {\n        for (const light of this.lights) {\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            switch (light.type) {\n                case LightType.SPHERE:\n                    queue.name = 'sphere-light';\n                    break;\n                case LightType.SPOT:\n                    queue.name = 'spot-light';\n                    break;\n                case LightType.POINT:\n                    queue.name = 'point-light';\n                    break;\n                case LightType.RANGED_DIRECTIONAL:\n                    queue.name = 'ranged-directional-light';\n                    break;\n                default:\n                    queue.name = 'unknown-light';\n            }\n            queue.addScene(\n                camera,\n                rendering.SceneFlags.BLEND,\n                light,\n            );\n        }\n    }\n    public addSpotlightShadowPasses(\n        ppl: rendering.BasicPipeline,\n        camera: renderer.scene.Camera,\n        maxNumShadowMaps: number,\n    ): void {\n        let i = 0;\n        for (const light of this.shadowEnabledSpotLights) {\n            const shadowMapSize = ppl.pipelineSceneData.shadows.size;\n            const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\n            shadowPass.name = `SpotLightShadowPass${i}`;\n            shadowPass.addRenderTarget(`SpotShadowMap${i}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n            shadowPass.addDepthStencil(`SpotShadowDepth${i}`, LoadOp.CLEAR, StoreOp.DISCARD);\n            shadowPass.addQueue(rendering.QueueHint.NONE, 'shadow-caster')\n                .addScene(camera, rendering.SceneFlags.OPAQUE | rendering.SceneFlags.MASK | rendering.SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light);\n            ++i;\n            if (i >= maxNumShadowMaps) {\n                break;\n            }\n        }\n    }\n    public addLightQueues(pass: rendering.BasicRenderPassBuilder,\n        camera: renderer.scene.Camera, maxNumShadowMaps: number): void {\n        this._addLightQueues(camera, pass);\n        let i = 0;\n        for (const light of this.shadowEnabledSpotLights) {\n            // Add spot-light pass\n            // Save last RenderPass to the `pass` variable\n            // TODO(zhouzhenglong): Fix per queue addTexture\n            pass.addTexture(`SpotShadowMap${i}`, 'cc_spotShadowMap');\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            queue.addScene(camera, rendering.SceneFlags.BLEND, light);\n            ++i;\n            if (i >= maxNumShadowMaps) {\n                break;\n            }\n        }\n    }\n\n    // Notice: ForwardLighting cannot handle a lot of lights.\n    // If there are too many lights, the performance will be very poor.\n    // If many lights are needed, please implement a forward+ or deferred rendering pipeline.\n    public addLightPasses(\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp,\n        id: number, // window id\n        width: number,\n        height: number,\n        camera: renderer.scene.Camera,\n        viewport: gfx.Viewport,\n        ppl: rendering.BasicPipeline,\n        pass: rendering.BasicRenderPassBuilder,\n    ): rendering.BasicRenderPassBuilder {\n        this._addLightQueues(camera, pass);\n\n        let count = 0;\n        const shadowMapSize = ppl.pipelineSceneData.shadows.size;\n        for (const light of this.shadowEnabledSpotLights) {\n            const shadowPass = ppl.addRenderPass(shadowMapSize.x, shadowMapSize.y, 'default');\n            shadowPass.name = 'SpotlightShadowPass';\n            // Reuse csm shadow map\n            shadowPass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n            shadowPass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\n            shadowPass.addQueue(rendering.QueueHint.NONE, 'shadow-caster')\n                .addScene(camera, rendering.SceneFlags.OPAQUE | rendering.SceneFlags.MASK | rendering.SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light);\n\n            // Add spot-light pass\n            // Save last RenderPass to the `pass` variable\n            ++count;\n            const storeOp = count === this.shadowEnabledSpotLights.length\n                ? depthStencilStoreOp\n                : StoreOp.STORE;\n\n            pass = ppl.addRenderPass(width, height, 'default');\n            pass.name = 'SpotlightWithShadowMap';\n            pass.setViewport(viewport);\n            pass.addRenderTarget(colorName, LoadOp.LOAD);\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, storeOp);\n            pass.addTexture(`ShadowMap${id}`, 'cc_spotShadowMap');\n            const queue = pass.addQueue(rendering.QueueHint.BLEND, 'forward-add');\n            queue.addScene(\n                camera,\n                rendering.SceneFlags.BLEND,\n                light,\n            );\n        }\n        return pass;\n    }\n\n    public isMultipleLightPassesNeeded(): boolean {\n        return this.shadowEnabledSpotLights.length > 0;\n    }\n}\n\nexport interface ForwardPassConfigs {\n    enableMainLightShadowMap: boolean;\n    enableMainLightPlanarShadowMap: boolean;\n    enablePlanarReflectionProbe: boolean;\n    enableMSAA: boolean;\n    enableSingleForwardPass: boolean;\n}\n\nexport class BuiltinForwardPassBuilder implements rendering.PipelinePassBuilder {\n    static ConfigOrder = 100;\n    static RenderOrder = 100;\n    getConfigOrder(): number {\n        return BuiltinForwardPassBuilder.ConfigOrder;\n    }\n    getRenderOrder(): number {\n        return BuiltinForwardPassBuilder.RenderOrder;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pipelineConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ForwardPassConfigs): void {\n        // Shadow\n        cameraConfigs.enableMainLightShadowMap = pipelineConfigs.shadowEnabled\n            && !pipelineConfigs.usePlanarShadow\n            && !!camera.scene\n            && !!camera.scene.mainLight\n            && camera.scene.mainLight.shadowEnabled;\n\n        cameraConfigs.enableMainLightPlanarShadowMap = pipelineConfigs.shadowEnabled\n            && pipelineConfigs.usePlanarShadow\n            && !!camera.scene\n            && !!camera.scene.mainLight\n            && camera.scene.mainLight.shadowEnabled;\n\n        // Reflection Probe\n        cameraConfigs.enablePlanarReflectionProbe = cameraConfigs.isMainGameWindow\n            || camera.cameraUsage === CameraUsage.SCENE_VIEW\n            || camera.cameraUsage === CameraUsage.GAME_VIEW;\n\n        // MSAA\n        cameraConfigs.enableMSAA = cameraConfigs.settings.msaa.enabled\n            && (!pipelineConfigs.isWebGL2 || (cameraConfigs.remainingPasses > 0 || (!macro.ENABLE_WEBGL_ANTIALIAS && macro.ENABLE_TRANSPARENT_CANVAS)))\n            && !cameraConfigs.enableStoreSceneDepth // Cannot store MS depth, resolve depth is also not cross-platform\n            && !pipelineConfigs.isWebGL1;\n\n        // Forward rendering (Depend on MSAA and TBR)\n        cameraConfigs.enableSingleForwardPass\n            = pipelineConfigs.isMobile || cameraConfigs.enableMSAA;\n\n        ++cameraConfigs.remainingPasses;\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        window: renderer.RenderWindow,\n        camera: renderer.scene.Camera,\n        nativeWidth: number,\n        nativeHeight: number): void {\n        const ResourceFlags = rendering.ResourceFlags;\n        const ResourceResidency = rendering.ResourceResidency;\n        const id = window.renderWindowId;\n        const settings = cameraConfigs.settings;\n\n        const width = cameraConfigs.enableShadingScale\n            ? Math.max(Math.floor(nativeWidth * cameraConfigs.shadingScale), 1)\n            : nativeWidth;\n        const height = cameraConfigs.enableShadingScale\n            ? Math.max(Math.floor(nativeHeight * cameraConfigs.shadingScale), 1)\n            : nativeHeight;\n\n        // MsaaRadiance\n        if (cameraConfigs.enableMSAA) {\n            // Notice: We never store multisample results.\n            // These samples are always resolved and discarded at the end of the render pass.\n            // So the ResourceResidency should be MEMORYLESS.\n            if (cameraConfigs.enableHDR) {\n                ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, cameraConfigs.radianceFormat, width, height, 1, 1, 1,\n                    settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\n            } else {\n                ppl.addTexture(`MsaaRadiance${id}`, TextureType.TEX2D, Format.RGBA8, width, height, 1, 1, 1,\n                    settings.msaa.sampleCount, ResourceFlags.COLOR_ATTACHMENT, ResourceResidency.MEMORYLESS);\n            }\n            ppl.addTexture(`MsaaDepthStencil${id}`, TextureType.TEX2D, Format.DEPTH_STENCIL, width, height, 1, 1, 1,\n                settings.msaa.sampleCount, ResourceFlags.DEPTH_STENCIL_ATTACHMENT, ResourceResidency.MEMORYLESS);\n        }\n\n        // Mainlight ShadowMap\n        ppl.addRenderTarget(\n            `ShadowMap${id}`,\n            pplConfigs.shadowMapFormat,\n            pplConfigs.shadowMapSize.x,\n            pplConfigs.shadowMapSize.y,\n        );\n        ppl.addDepthStencil(\n            `ShadowDepth${id}`,\n            Format.DEPTH_STENCIL,\n            pplConfigs.shadowMapSize.x,\n            pplConfigs.shadowMapSize.y,\n        );\n\n        // Spot-light shadow maps\n        if (cameraConfigs.enableSingleForwardPass) {\n            const count = pplConfigs.mobileMaxSpotLightShadowMaps;\n            for (let i = 0; i !== count; ++i) {\n                ppl.addRenderTarget(\n                    `SpotShadowMap${i}`,\n                    pplConfigs.shadowMapFormat,\n                    pplConfigs.shadowMapSize.x,\n                    pplConfigs.shadowMapSize.y,\n                );\n                ppl.addDepthStencil(\n                    `SpotShadowDepth${i}`,\n                    Format.DEPTH_STENCIL,\n                    pplConfigs.shadowMapSize.x,\n                    pplConfigs.shadowMapSize.y,\n                );\n            }\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ForwardPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext): rendering.BasicRenderPassBuilder | undefined {\n        // Add global constants\n        ppl.setVec4('g_platform', pplConfigs.platform);\n\n        const id = camera.window.renderWindowId;\n\n        const scene = camera.scene!;\n        const mainLight = scene.mainLight;\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        // Forward Lighting (Light Culling)\n        this.forwardLighting.cullLights(scene, camera.frustum);\n\n        // Main Directional light CSM Shadow Map\n        if (cameraConfigs.enableMainLightShadowMap) {\n            assert(!!mainLight);\n            this._addCascadedShadowMapPass(ppl, pplConfigs, id, mainLight, camera);\n        }\n\n        // Spot light shadow maps (Mobile or MSAA)\n        if (cameraConfigs.enableSingleForwardPass) {\n            // Currently, only support 1 spot light with shadow map on mobile platform.\n            // TODO(zhouzhenglong): Relex this limitation.\n            this.forwardLighting.addSpotlightShadowPasses(\n                ppl, camera, pplConfigs.mobileMaxSpotLightShadowMaps);\n        }\n\n        this._tryAddReflectionProbePasses(ppl, cameraConfigs, id, mainLight, camera.scene);\n\n        if (cameraConfigs.remainingPasses > 0 || cameraConfigs.enableShadingScale) {\n            context.colorName = cameraConfigs.enableShadingScale\n                ? `ScaledRadiance0_${id}`\n                : `Radiance0_${id}`;\n            context.depthStencilName = cameraConfigs.enableShadingScale\n                ? `ScaledSceneDepth_${id}`\n                : `SceneDepth_${id}`;\n        } else {\n            context.colorName = cameraConfigs.colorName;\n            context.depthStencilName = cameraConfigs.depthStencilName;\n        }\n\n        const pass = this._addForwardRadiancePasses(\n            ppl, pplConfigs, cameraConfigs, id, camera,\n            cameraConfigs.width, cameraConfigs.height, mainLight,\n            context.colorName, context.depthStencilName,\n            !cameraConfigs.enableMSAA,\n            cameraConfigs.enableStoreSceneDepth ? StoreOp.STORE : StoreOp.DISCARD);\n\n        if (!cameraConfigs.enableStoreSceneDepth) {\n            context.depthStencilName = '';\n        }\n\n        if (cameraConfigs.remainingPasses === 0 && cameraConfigs.enableShadingScale) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, context.colorName);\n        } else {\n            return pass;\n        }\n    }\n    private _addCascadedShadowMapPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        id: number,\n        light: renderer.scene.DirectionalLight,\n        camera: renderer.scene.Camera,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // ----------------------------------------------------------------\n        // Dynamic states\n        // ----------------------------------------------------------------\n        const shadowSize = ppl.pipelineSceneData.shadows.size;\n        const width = shadowSize.x;\n        const height = shadowSize.y;\n\n        const viewport = this._viewport;\n        viewport.left = viewport.top = 0;\n        viewport.width = width;\n        viewport.height = height;\n\n        // ----------------------------------------------------------------\n        // CSM Shadow Map\n        // ----------------------------------------------------------------\n        const pass = ppl.addRenderPass(width, height, 'default');\n        pass.name = 'CascadedShadowMap';\n        pass.addRenderTarget(`ShadowMap${id}`, LoadOp.CLEAR, StoreOp.STORE, new Color(1, 1, 1, 1));\n        pass.addDepthStencil(`ShadowDepth${id}`, LoadOp.CLEAR, StoreOp.DISCARD);\n        const csmLevel = ppl.pipelineSceneData.csmSupported ? light.csmLevel : 1;\n\n        // Add shadow map viewports\n        for (let level = 0; level !== csmLevel; ++level) {\n            getCsmMainLightViewport(light, width, height, level, this._viewport, pplConfigs.screenSpaceSignY);\n            const queue = pass.addQueue(QueueHint.NONE, 'shadow-caster');\n            if (!pplConfigs.isWebGPU) { // Temporary workaround for WebGPU\n                queue.setViewport(this._viewport);\n            }\n            queue\n                .addScene(camera, SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.SHADOW_CASTER)\n                .useLightFrustum(light, level);\n        }\n    }\n    private _tryAddReflectionProbePasses(\n        ppl: rendering.BasicPipeline,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null,\n    ): void {\n        const reflectionProbeManager = cclegacy.internal.reflectionProbeManager as ReflectionProbeManager | undefined;\n        if (!reflectionProbeManager) {\n            return;\n        }\n        const ResourceResidency = rendering.ResourceResidency;\n        const probes = reflectionProbeManager.getProbes();\n        const maxProbeCount = 4;\n        let probeID = 0;\n        for (const probe of probes) {\n            if (!probe.needRender) {\n                continue;\n            }\n            const area = probe.renderArea();\n            const width = Math.max(Math.floor(area.x), 1);\n            const height = Math.max(Math.floor(area.y), 1);\n\n            if (probe.probeType === renderer.scene.ProbeType.PLANAR) {\n                if (!cameraConfigs.enablePlanarReflectionProbe) {\n                    continue;\n                }\n                const window: renderer.RenderWindow = probe.realtimePlanarTexture!.window!;\n                const colorName = `PlanarProbeRT${probeID}`;\n                const depthStencilName = `PlanarProbeDS${probeID}`;\n                // ProbeResource\n                ppl.addRenderWindow(colorName,\n                    cameraConfigs.radianceFormat, width, height, window);\n                ppl.addDepthStencil(depthStencilName,\n                    gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\n\n                // Rendering\n                const probePass = ppl.addRenderPass(width, height, 'default');\n                probePass.name = `PlanarReflectionProbe${probeID}`;\n                this._buildReflectionProbePass(probePass, cameraConfigs, id, probe.camera,\n                    colorName, depthStencilName, mainLight, scene);\n            } else if (EDITOR) {\n                for (let faceIdx = 0; faceIdx < probe.bakedCubeTextures.length; faceIdx++) {\n                    probe.updateCameraDir(faceIdx);\n                    const window: renderer.RenderWindow = probe.bakedCubeTextures[faceIdx].window!;\n                    const colorName = `CubeProbeRT${probeID}${faceIdx}`;\n                    const depthStencilName = `CubeProbeDS${probeID}${faceIdx}`;\n                    // ProbeResource\n                    ppl.addRenderWindow(colorName,\n                        cameraConfigs.radianceFormat, width, height, window);\n                    ppl.addDepthStencil(depthStencilName,\n                        gfx.Format.DEPTH_STENCIL, width, height, ResourceResidency.MEMORYLESS);\n\n                    // Rendering\n                    const probePass = ppl.addRenderPass(width, height, 'default');\n                    probePass.name = `CubeProbe${probeID}${faceIdx}`;\n                    this._buildReflectionProbePass(probePass, cameraConfigs, id, probe.camera,\n                        colorName, depthStencilName, mainLight, scene);\n                }\n                probe.needRender = false;\n            }\n            ++probeID;\n            if (probeID === maxProbeCount) {\n                break;\n            }\n        }\n    }\n    private _buildReflectionProbePass(\n        pass: rendering.BasicRenderPassBuilder,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        colorName: string,\n        depthStencilName: string,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null = null,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // set viewport\n        const colorStoreOp = cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\n\n        // bind output render target\n        if (forwardNeedClearColor(camera)) {\n            this._reflectionProbeClearColor.x = camera.clearColor.x;\n            this._reflectionProbeClearColor.y = camera.clearColor.y;\n            this._reflectionProbeClearColor.z = camera.clearColor.z;\n            const clearColor = rendering.packRGBE(this._reflectionProbeClearColor);\n            this._clearColor.x = clearColor.x;\n            this._clearColor.y = clearColor.y;\n            this._clearColor.z = clearColor.z;\n            this._clearColor.w = clearColor.w;\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\n        } else {\n            pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\n        }\n\n        // bind depth stencil buffer\n        if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n            pass.addDepthStencil(\n                depthStencilName,\n                LoadOp.CLEAR,\n                StoreOp.DISCARD,\n                camera.clearDepth,\n                camera.clearStencil,\n                camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n            );\n        } else {\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\n        }\n\n        // Set shadow map if enabled\n        if (cameraConfigs.enableMainLightShadowMap) {\n            pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\n        }\n\n        // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\n\n        // add opaque and mask queue\n        pass.addQueue(QueueHint.NONE, 'reflect-map') // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\n            .addScene(camera,\n                SceneFlags.OPAQUE | SceneFlags.MASK | SceneFlags.REFLECTION_PROBE,\n                mainLight || undefined,\n                scene ? scene : undefined);\n    }\n    private _addForwardRadiancePasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        disableMSAA: boolean = false,\n        depthStencilStoreOp: gfx.StoreOp = StoreOp.DISCARD,\n    ): rendering.BasicRenderPassBuilder {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // ----------------------------------------------------------------\n        // Dynamic states\n        // ----------------------------------------------------------------\n        // Prepare camera clear color\n        const clearColor = camera.clearColor; // Reduce C++/TS interop\n        this._clearColor.x = clearColor.x;\n        this._clearColor.y = clearColor.y;\n        this._clearColor.z = clearColor.z;\n        this._clearColor.w = clearColor.w;\n\n        // Prepare camera viewport\n        const viewport = camera.viewport; // Reduce C++/TS interop\n        this._viewport.left = Math.round(viewport.x * width);\n        this._viewport.top = Math.round(viewport.y * height);\n        // Here we must use camera.viewport.width instead of camera.viewport.z, which\n        // is undefined on native platform. The same as camera.viewport.height.\n        this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\n        this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\n\n        // MSAA\n        const enableMSAA = !disableMSAA && cameraConfigs.enableMSAA;\n        assert(!enableMSAA || cameraConfigs.enableSingleForwardPass);\n\n        // ----------------------------------------------------------------\n        // Forward Lighting (Main Directional Light)\n        // ----------------------------------------------------------------\n        const pass = cameraConfigs.enableSingleForwardPass\n            ? this._addForwardSingleRadiancePass(ppl, pplConfigs, cameraConfigs,\n                id, camera, enableMSAA, width, height, mainLight,\n                colorName, depthStencilName, depthStencilStoreOp)\n            : this._addForwardMultipleRadiancePasses(ppl, cameraConfigs,\n                id, camera, width, height, mainLight,\n                colorName, depthStencilName, depthStencilStoreOp);\n\n        // Planar Shadow\n        if (cameraConfigs.enableMainLightPlanarShadowMap) {\n            this._addPlanarShadowQueue(camera, mainLight, pass);\n        }\n\n        // ----------------------------------------------------------------\n        // Forward Lighting (Blend)\n        // ----------------------------------------------------------------\n        // Add transparent queue\n\n        const sceneFlags = SceneFlags.BLEND |\n            (camera.geometryRenderer\n                ? SceneFlags.GEOMETRY\n                : SceneFlags.NONE);\n\n        pass\n            .addQueue(QueueHint.BLEND)\n            .addScene(camera, sceneFlags, mainLight || undefined);\n\n        return pass;\n    }\n    private _addForwardSingleRadiancePass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        enableMSAA: boolean,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp\n    ): rendering.BasicRenderPassBuilder {\n        assert(cameraConfigs.enableSingleForwardPass);\n        // ----------------------------------------------------------------\n        // Forward Lighting (Main Directional Light)\n        // ----------------------------------------------------------------\n        let pass: rendering.BasicRenderPassBuilder;\n        if (enableMSAA) {\n            const msaaRadianceName = `MsaaRadiance${id}`;\n            const msaaDepthStencilName = `MsaaDepthStencil${id}`;\n            const sampleCount = cameraConfigs.settings.msaa.sampleCount;\n\n            const msPass = ppl.addMultisampleRenderPass(width, height, sampleCount, 0, 'default');\n            msPass.name = 'MsaaForwardPass';\n\n            // MSAA always discards depth stencil\n            this._buildForwardMainLightPass(msPass, cameraConfigs, id, camera,\n                msaaRadianceName, msaaDepthStencilName, StoreOp.DISCARD, mainLight);\n\n            msPass.resolveRenderTarget(msaaRadianceName, colorName);\n\n            pass = msPass;\n        } else {\n            pass = ppl.addRenderPass(width, height, 'default');\n            pass.name = 'ForwardPass';\n\n            this._buildForwardMainLightPass(pass, cameraConfigs, id, camera,\n                colorName, depthStencilName, depthStencilStoreOp, mainLight);\n        }\n        assert(pass !== undefined);\n\n        // Forward Lighting (Additive Lights)\n        this.forwardLighting.addLightQueues(\n            pass,\n            camera,\n            pplConfigs.mobileMaxSpotLightShadowMaps,\n        );\n\n        return pass;\n    }\n    private _addForwardMultipleRadiancePasses(\n        ppl: rendering.BasicPipeline,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        width: number,\n        height: number,\n        mainLight: renderer.scene.DirectionalLight | null,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp\n    ): rendering.BasicRenderPassBuilder {\n        assert(!cameraConfigs.enableSingleForwardPass);\n\n        // Forward Lighting (Main Directional Light)\n        let pass = ppl.addRenderPass(width, height, 'default');\n        pass.name = 'ForwardPass';\n\n        const firstStoreOp = this.forwardLighting.isMultipleLightPassesNeeded()\n            ? StoreOp.STORE\n            : depthStencilStoreOp;\n\n        this._buildForwardMainLightPass(pass, cameraConfigs,\n            id, camera, colorName, depthStencilName, firstStoreOp, mainLight);\n\n        // Forward Lighting (Additive Lights)\n        pass = this.forwardLighting\n            .addLightPasses(colorName, depthStencilName, depthStencilStoreOp,\n                id, width, height, camera, this._viewport, ppl, pass);\n\n        return pass;\n    }\n    private _buildForwardMainLightPass(\n        pass: rendering.BasicRenderPassBuilder,\n        cameraConfigs: Readonly<CameraConfigs & ForwardPassConfigs>,\n        id: number,\n        camera: renderer.scene.Camera,\n        colorName: string,\n        depthStencilName: string,\n        depthStencilStoreOp: gfx.StoreOp,\n        mainLight: renderer.scene.DirectionalLight | null,\n        scene: renderer.RenderScene | null = null,\n    ): void {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        // set viewport\n        pass.setViewport(this._viewport);\n\n        const colorStoreOp = cameraConfigs.enableMSAA ? StoreOp.DISCARD : StoreOp.STORE;\n\n        // bind output render target\n        if (forwardNeedClearColor(camera)) {\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, colorStoreOp, this._clearColor);\n        } else {\n            pass.addRenderTarget(colorName, LoadOp.LOAD, colorStoreOp);\n        }\n\n        // bind depth stencil buffer\n        if (DEBUG) {\n            if (colorName === cameraConfigs.colorName &&\n                depthStencilName !== cameraConfigs.depthStencilName) {\n                warn('Default framebuffer cannot use custom depth stencil buffer');\n            }\n        }\n\n        if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n            pass.addDepthStencil(\n                depthStencilName,\n                LoadOp.CLEAR,\n                depthStencilStoreOp,\n                camera.clearDepth,\n                camera.clearStencil,\n                camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n            );\n        } else {\n            pass.addDepthStencil(depthStencilName, LoadOp.LOAD, depthStencilStoreOp);\n        }\n\n        // Set shadow map if enabled\n        if (cameraConfigs.enableMainLightShadowMap) {\n            pass.addTexture(`ShadowMap${id}`, 'cc_shadowMap');\n        }\n\n        // TODO(zhouzhenglong): Separate OPAQUE and MASK queue\n\n        // add opaque and mask queue\n        pass.addQueue(QueueHint.NONE) // Currently we put OPAQUE and MASK into one queue, so QueueHint is NONE\n            .addScene(camera,\n                SceneFlags.OPAQUE | SceneFlags.MASK,\n                mainLight || undefined,\n                scene ? scene : undefined);\n    }\n    private _addPlanarShadowQueue(\n        camera: renderer.scene.Camera,\n        mainLight: renderer.scene.DirectionalLight | null,\n        pass: rendering.BasicRenderPassBuilder,\n    ) {\n        const QueueHint = rendering.QueueHint;\n        const SceneFlags = rendering.SceneFlags;\n        pass.addQueue(QueueHint.BLEND, 'planar-shadow')\n            .addScene(\n                camera,\n                SceneFlags.SHADOW_CASTER | SceneFlags.PLANAR_SHADOW | SceneFlags.BLEND,\n                mainLight || undefined,\n            );\n    }\n    private readonly forwardLighting = new ForwardLighting();\n    private readonly _viewport = new Viewport();\n    private readonly _clearColor = new Color(0, 0, 0, 1);\n    private readonly _reflectionProbeClearColor = new Vec3(0, 0, 0);\n}\n\nexport interface BloomPassConfigs {\n    enableBloom: boolean;\n}\n\nfunction downSize(size: number, scale: number): number {\n    return Math.max(Math.floor(size * scale), 1);\n}\n\ninterface RenderTextureDesc {\n    name: string;\n    width: number;\n    height: number;\n}\n\nexport class BuiltinBloomPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 200;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pipelineConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs): void {\n        const { bloom } = cameraConfigs.settings;\n        const hasValidMaterial = (\n            bloom.type === BloomType.KawaseDualFilter && !!bloom.kawaseFilterMaterial ||\n            bloom.type === BloomType.MipmapFilter && !!bloom.mipmapFilterMaterial\n        );\n        cameraConfigs.enableBloom = bloom.enabled && hasValidMaterial;\n\n        if (cameraConfigs.enableBloom) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs,\n        window: renderer.RenderWindow): void {\n        if (!cameraConfigs.enableBloom) {\n            return;\n        }\n\n        const { width, height, settings: { bloom } } = cameraConfigs;\n        const id = window.renderWindowId;\n        const format = cameraConfigs.radianceFormat;\n\n        if (bloom.type === BloomType.KawaseDualFilter) {\n            let bloomWidth = cameraConfigs.width;\n            let bloomHeight = cameraConfigs.height;\n            for (let i = 0; i !== bloom.iterations + 1; ++i) {\n                bloomWidth = Math.max(Math.floor(bloomWidth / 2), 1);\n                bloomHeight = Math.max(Math.floor(bloomHeight / 2), 1);\n                ppl.addRenderTarget(`BloomTex${id}_${i}`, format, bloomWidth, bloomHeight);\n            }\n        } else if (bloom.type === BloomType.MipmapFilter) {\n            const iterations = bloom.iterations;\n            for (let i = 0; i !== iterations + 1; ++i) {\n                // DownSample\n                if (i < iterations) {\n                    const scale = Math.pow(0.5, i + 2);\n                    this._bloomDownSampleTexDescs[i] = this.createTexture(\n                        ppl,\n                        `DownSampleColor${id}${i}`,\n                        downSize(width, scale),\n                        downSize(height, scale),\n                        format);\n                }\n                // UpSample\n                if (i < iterations - 1) {\n                    const scale = Math.pow(0.5, iterations - i - 1);\n                    this._bloomUpSampleTexDescs[i] = this.createTexture(\n                        ppl,\n                        `UpSampleColor${id}${i}`,\n                        downSize(width, scale),\n                        downSize(height, scale),\n                        format);\n                }\n            }\n            this._originalColorDesc = this.createTexture(ppl, `OriginalColor${id}`, width, height, format);\n            this._prefilterTexDesc = this.createTexture(ppl, `PrefilterColor${id}`,\n                downSize(width, 0.5), downSize(height, 0.5), format);\n        }\n    }\n    private createTexture(\n        ppl: rendering.BasicPipeline,\n        name: string, width: number, height: number, format: number): RenderTextureDesc {\n        const desc = { name, width, height };\n        ppl.addRenderTarget(desc.name, format, desc.width, desc.height);\n        return desc;\n    }\n\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & BloomPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableBloom) {\n            return prevRenderPass;\n        }\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        const bloom = cameraConfigs.settings.bloom;\n        const id = camera.window.renderWindowId;\n\n        switch (bloom.type) {\n            case BloomType.KawaseDualFilter: {\n                const material = bloom.kawaseFilterMaterial;\n                assert(!!material);\n                return this._addKawaseDualFilterBloomPasses(\n                    ppl, pplConfigs,\n                    cameraConfigs,\n                    cameraConfigs.settings,\n                    material,\n                    id,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName);\n            }\n            case BloomType.MipmapFilter: {\n                const material = bloom.mipmapFilterMaterial;\n                assert(!!material);\n                return this._addMipmapFilterBloomPasses(\n                    ppl, pplConfigs,\n                    cameraConfigs,\n                    cameraConfigs.settings,\n                    material,\n                    id,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName);\n            }\n            default:\n                return prevRenderPass;\n        }\n    }\n    private _addKawaseDualFilterBloomPasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & Readonly<BloomPassConfigs>,\n        settings: PipelineSettings,\n        bloomMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        radianceName: string,\n    ): rendering.BasicRenderPassBuilder {\n        const QueueHint = rendering.QueueHint;\n        // Based on Kawase Dual Filter Blur. Saves bandwidth on mobile devices.\n        // eslint-disable-next-line max-len\n        // https://community.arm.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-20-66/siggraph2015_2D00_mmg_2D00_marius_2D00_slides.pdf\n\n        // Size: [prefilter(1/2), downsample(1/4), downsample(1/8), downsample(1/16), ...]\n        const iterations = settings.bloom.iterations;\n        const sizeCount = iterations + 1;\n        this._bloomWidths.length = sizeCount;\n        this._bloomHeights.length = sizeCount;\n        this._bloomWidths[0] = Math.max(Math.floor(width / 2), 1);\n        this._bloomHeights[0] = Math.max(Math.floor(height / 2), 1);\n        for (let i = 1; i !== sizeCount; ++i) {\n            this._bloomWidths[i] = Math.max(Math.floor(this._bloomWidths[i - 1] / 2), 1);\n            this._bloomHeights[i] = Math.max(Math.floor(this._bloomHeights[i - 1] / 2), 1);\n        }\n\n        // Bloom texture names\n        this._bloomTexNames.length = sizeCount;\n        for (let i = 0; i !== sizeCount; ++i) {\n            this._bloomTexNames[i] = `BloomTex${id}_${i}`;\n        }\n\n        // Setup bloom parameters\n        this._bloomParams.x = pplConfigs.useFloatOutput ? 1 : 0;\n        this._bloomParams.y = 0; // unused\n        this._bloomParams.z = settings.bloom.threshold;\n        this._bloomParams.w = settings.bloom.enableAlphaMask ? 1 : 0;\n\n        // Prefilter pass\n        const prefilterPass = ppl.addRenderPass(this._bloomWidths[0], this._bloomHeights[0], 'cc-bloom-prefilter');\n        prefilterPass.addRenderTarget(\n            this._bloomTexNames[0],\n            LoadOp.CLEAR,\n            StoreOp.STORE,\n            this._clearColorTransparentBlack,\n        );\n        prefilterPass.addTexture(radianceName, 'inputTexture');\n        prefilterPass.setVec4('bloomParams', this._bloomParams);\n        prefilterPass\n            .addQueue(QueueHint.OPAQUE)\n            .addFullscreenQuad(bloomMaterial, 0);\n\n        // Downsample passes\n        for (let i = 1; i !== sizeCount; ++i) {\n            const downPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-downsample');\n            downPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\n            downPass.addTexture(this._bloomTexNames[i - 1], 'bloomTexture');\n            this._bloomTexSize.x = this._bloomWidths[i - 1];\n            this._bloomTexSize.y = this._bloomHeights[i - 1];\n            downPass.setVec4('bloomTexSize', this._bloomTexSize);\n            downPass\n                .addQueue(QueueHint.OPAQUE)\n                .addFullscreenQuad(bloomMaterial, 1);\n        }\n\n        // Upsample passes\n        for (let i = iterations; i-- > 0;) {\n            const upPass = ppl.addRenderPass(this._bloomWidths[i], this._bloomHeights[i], 'cc-bloom-upsample');\n            upPass.addRenderTarget(this._bloomTexNames[i], LoadOp.CLEAR, StoreOp.STORE, this._clearColorTransparentBlack);\n            upPass.addTexture(this._bloomTexNames[i + 1], 'bloomTexture');\n            this._bloomTexSize.x = this._bloomWidths[i + 1];\n            this._bloomTexSize.y = this._bloomHeights[i + 1];\n            upPass.setVec4('bloomTexSize', this._bloomTexSize);\n            upPass\n                .addQueue(QueueHint.OPAQUE)\n                .addFullscreenQuad(bloomMaterial, 2);\n        }\n\n        // Combine pass\n        this._bloomParams.w = settings.bloom.intensity;\n        const combinePass = ppl.addRenderPass(width, height, 'cc-bloom-combine');\n        combinePass.addRenderTarget(radianceName, LoadOp.LOAD, StoreOp.STORE);\n        combinePass.addTexture(this._bloomTexNames[0], 'bloomTexture');\n        combinePass.setVec4('bloomParams', this._bloomParams);\n        combinePass\n            .addQueue(QueueHint.BLEND)\n            .addFullscreenQuad(bloomMaterial, 3);\n\n        if (cameraConfigs.remainingPasses === 0) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, radianceName);\n        } else {\n            return combinePass;\n        }\n    }\n    private _addPass(\n        ppl: rendering.BasicPipeline,\n        width: number,\n        height: number,\n        layout: string,\n        colorName: string,\n        material: Material,\n        passIndex: number,\n        loadOp: gfx.LoadOp = LoadOp.CLEAR,\n        clearColor: gfx.Color = sClearColorTransparentBlack,\n        queueHint: rendering.QueueHint = rendering.QueueHint.OPAQUE): rendering.BasicRenderPassBuilder {\n        const pass = ppl.addRenderPass(width, height, layout);\n        pass.addRenderTarget(colorName, loadOp, StoreOp.STORE, clearColor);\n        pass.addQueue(queueHint)\n            .addFullscreenQuad(material, passIndex);\n        return pass;\n    }\n    private _addMipmapFilterBloomPasses(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & Readonly<BloomPassConfigs>,\n        settings: PipelineSettings,\n        bloomMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        radianceName: string,\n    ): rendering.BasicRenderPassBuilder {\n        // Setup bloom parameters\n        this._bloomParams.x = pplConfigs.useFloatOutput ? 1 : 0;\n        this._bloomParams.x = 0; // unused\n        this._bloomParams.z = settings.bloom.threshold;\n        this._bloomParams.w = settings.bloom.intensity;\n        const prefilterInfo = this._prefilterTexDesc;\n\n        // Prefilter pass\n        let currSamplePass = this._addPass(\n            ppl,\n            prefilterInfo.width,\n            prefilterInfo.height,\n            'cc-bloom-mipmap-prefilter',\n            prefilterInfo.name,\n            bloomMaterial,\n            0,\n        );\n        currSamplePass.addTexture(radianceName, 'mainTexture');\n        currSamplePass.setVec4('bloomParams', this._bloomParams);\n\n        const downSampleInfos = this._bloomDownSampleTexDescs;\n        // Downsample passes\n        for (let i = 0; i < downSampleInfos.length; ++i) {\n            const currInfo = downSampleInfos[i];\n            const samplerSrc = i === 0 ? prefilterInfo : downSampleInfos[i - 1];\n            const samplerSrcName = samplerSrc.name;\n            this._bloomTexSize.x = 1 / samplerSrc.width;\n            this._bloomTexSize.y = 1 / samplerSrc.height;\n            currSamplePass = this._addPass(\n                ppl,\n                currInfo.width,\n                currInfo.height,\n                'cc-bloom-mipmap-downsample',\n                currInfo.name,\n                bloomMaterial,\n                1,\n            );\n            currSamplePass.addTexture(samplerSrcName, 'mainTexture');\n            currSamplePass.setVec4('bloomParams', this._bloomTexSize);\n        }\n        const lastIndex = downSampleInfos.length - 1;\n        const upSampleInfos = this._bloomUpSampleTexDescs;\n        // Upsample passes\n        for (let i = 0; i < upSampleInfos.length; i++) {\n            const currInfo = upSampleInfos[i];\n            const sampleSrc = i === 0 ? downSampleInfos[lastIndex] : upSampleInfos[i - 1];\n            const sampleSrcName = sampleSrc.name;\n            this._bloomTexSize.x = 1 / sampleSrc.width;\n            this._bloomTexSize.y = 1 / sampleSrc.height;\n            currSamplePass = this._addPass(\n                ppl,\n                currInfo.width,\n                currInfo.height,\n                'cc-bloom-mipmap-upsample',\n                currInfo.name,\n                bloomMaterial,\n                2,\n            );\n            currSamplePass.addTexture(sampleSrcName, 'mainTexture');\n            currSamplePass.addTexture(downSampleInfos[lastIndex - 1 - i].name, 'downsampleTexture');\n            currSamplePass.setVec4('bloomParams', this._bloomTexSize);\n        }\n\n        // Combine pass\n        const combinePass = this._addPass(\n            ppl,\n            width,\n            height,\n            'cc-bloom-mipmap-combine',\n            radianceName,\n            bloomMaterial,\n            3,\n            LoadOp.LOAD,\n        );\n        combinePass.addTexture(upSampleInfos[upSampleInfos.length - 1].name, 'bloomTexture');\n        combinePass.setVec4('bloomParams', this._bloomParams);\n        if (cameraConfigs.remainingPasses === 0) {\n            return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, radianceName);\n        } else {\n            return combinePass;\n        }\n    }\n\n    // Bloom\n    private readonly _clearColorTransparentBlack = new Color(0, 0, 0, 0);\n    private readonly _bloomParams = new Vec4(0, 0, 0, 0);\n    private readonly _bloomTexSize = new Vec4(0, 0, 0, 0);\n    private readonly _bloomWidths: Array<number> = [];\n    private readonly _bloomHeights: Array<number> = [];\n    private readonly _bloomTexNames: Array<string> = [];\n\n    // Mipmap Bloom\n    private readonly _bloomUpSampleTexDescs: Array<RenderTextureDesc> = [];\n    private readonly _bloomDownSampleTexDescs: Array<RenderTextureDesc> = [];\n    private _prefilterTexDesc: RenderTextureDesc = { name: '', width: 0, height: 0 };\n    private _originalColorDesc: RenderTextureDesc = { name: '', width: 0, height: 0 };\n}\n\nexport interface ToneMappingPassConfigs {\n    enableToneMapping: boolean;\n    enableColorGrading: boolean;\n}\n\nexport class BuiltinToneMappingPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 300;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs): void {\n        const settings = cameraConfigs.settings;\n\n        cameraConfigs.enableColorGrading\n            = settings.colorGrading.enabled\n            && !!settings.colorGrading.material\n            && !!settings.colorGrading.colorGradingMap;\n\n        cameraConfigs.enableToneMapping\n            = cameraConfigs.enableHDR // From Half to RGBA8\n            || cameraConfigs.enableColorGrading; // Color grading\n\n        if (cameraConfigs.enableToneMapping) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    windowResize(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs): void {\n        if (cameraConfigs.enableColorGrading) {\n            assert(!!cameraConfigs.settings.colorGrading.material);\n            cameraConfigs.settings.colorGrading.material.setProperty(\n                'colorGradingMap',\n                cameraConfigs.settings.colorGrading.colorGradingMap);\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableToneMapping) {\n            return prevRenderPass;\n        }\n\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n        if (cameraConfigs.remainingPasses === 0) {\n            return this._addCopyAndTonemapPass(ppl, pplConfigs, cameraConfigs,\n                cameraConfigs.width, cameraConfigs.height,\n                context.colorName, cameraConfigs.colorName);\n        } else {\n            const id = cameraConfigs.renderWindowId;\n            const ldrColorPrefix = cameraConfigs.enableShadingScale\n                ? `ScaledLdrColor`\n                : `LdrColor`;\n\n            const ldrColorName = getPingPongRenderTarget(context.colorName, ldrColorPrefix, id);\n            const radianceName = context.colorName;\n            context.colorName = ldrColorName;\n\n            return this._addCopyAndTonemapPass(ppl, pplConfigs, cameraConfigs,\n                cameraConfigs.width, cameraConfigs.height,\n                radianceName, ldrColorName);\n        }\n    }\n    private _addCopyAndTonemapPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & ToneMappingPassConfigs,\n        width: number,\n        height: number,\n        radianceName: string,\n        colorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        let pass: rendering.BasicRenderPassBuilder;\n        const settings = cameraConfigs.settings;\n        if (cameraConfigs.enableColorGrading) {\n            assert(!!settings.colorGrading.material);\n            assert(!!settings.colorGrading.colorGradingMap);\n\n            const lutTex = settings.colorGrading.colorGradingMap;\n            this._colorGradingTexSize.x = lutTex.width;\n            this._colorGradingTexSize.y = lutTex.height;\n\n            const isSquareMap = lutTex.width === lutTex.height;\n            if (isSquareMap) {\n                pass = ppl.addRenderPass(width, height, 'cc-color-grading-8x8');\n            } else {\n                pass = ppl.addRenderPass(width, height, 'cc-color-grading-nx1');\n            }\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n            pass.addTexture(radianceName, 'sceneColorMap');\n            pass.setVec2('lutTextureSize', this._colorGradingTexSize);\n            pass.setFloat('contribute', settings.colorGrading.contribute);\n            pass.addQueue(rendering.QueueHint.OPAQUE)\n                .addFullscreenQuad(settings.colorGrading.material, isSquareMap ? 1 : 0);\n        } else {\n            pass = ppl.addRenderPass(width, height, 'cc-tone-mapping');\n            pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n            pass.addTexture(radianceName, 'inputTexture');\n            if (settings.toneMapping.material) {\n                pass.addQueue(rendering.QueueHint.OPAQUE)\n                    .addFullscreenQuad(settings.toneMapping.material, 0);\n            } else {\n                assert(!!cameraConfigs.copyAndTonemapMaterial);\n                pass.addQueue(rendering.QueueHint.OPAQUE)\n                    .addFullscreenQuad(cameraConfigs.copyAndTonemapMaterial, 0);\n            }\n        }\n        return pass;\n    }\n    private readonly _colorGradingTexSize = new Vec2(0, 0);\n}\n\nexport interface FXAAPassConfigs {\n    enableFXAA: boolean;\n}\n\nexport class BuiltinFXAAPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 400;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FXAAPassConfigs): void {\n        cameraConfigs.enableFXAA\n            = cameraConfigs.settings.fxaa.enabled\n            && !!cameraConfigs.settings.fxaa.material;\n        if (cameraConfigs.enableFXAA) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FXAAPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableFXAA) {\n            return prevRenderPass;\n        }\n        --cameraConfigs.remainingPasses;\n        assert(cameraConfigs.remainingPasses >= 0);\n\n        const id = cameraConfigs.renderWindowId;\n        const ldrColorPrefix = cameraConfigs.enableShadingScale\n            ? `ScaledLdrColor`\n            : `LdrColor`;\n        const ldrColorName = getPingPongRenderTarget(context.colorName, ldrColorPrefix, id);\n\n        assert(!!cameraConfigs.settings.fxaa.material);\n        if (cameraConfigs.remainingPasses === 0) {\n            if (cameraConfigs.enableShadingScale) {\n                this._addFxaaPass(ppl, pplConfigs,\n                    cameraConfigs.settings.fxaa.material,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName,\n                    ldrColorName);\n                return addCopyToScreenPass(ppl, pplConfigs, cameraConfigs, ldrColorName);\n            } else {\n                assert(cameraConfigs.width === cameraConfigs.nativeWidth);\n                assert(cameraConfigs.height === cameraConfigs.nativeHeight);\n                return this._addFxaaPass(ppl, pplConfigs,\n                    cameraConfigs.settings.fxaa.material,\n                    cameraConfigs.width,\n                    cameraConfigs.height,\n                    context.colorName,\n                    cameraConfigs.colorName);\n            }\n        } else {\n            const inputColorName = context.colorName;\n            context.colorName = ldrColorName;\n            const lastPass = this._addFxaaPass(ppl, pplConfigs,\n                cameraConfigs.settings.fxaa.material,\n                cameraConfigs.width,\n                cameraConfigs.height,\n                inputColorName,\n                ldrColorName);\n            return lastPass;\n        }\n    }\n    private _addFxaaPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        fxaaMaterial: Material,\n        width: number,\n        height: number,\n        ldrColorName: string,\n        colorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        this._fxaaParams.x = width;\n        this._fxaaParams.y = height;\n        this._fxaaParams.z = 1 / width;\n        this._fxaaParams.w = 1 / height;\n\n        const pass = ppl.addRenderPass(width, height, 'cc-fxaa');\n        pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        pass.addTexture(ldrColorName, 'sceneColorMap');\n        pass.setVec4('texSize', this._fxaaParams);\n        pass.addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fxaaMaterial, 0);\n        return pass;\n    }\n    // FXAA\n    private readonly _fxaaParams = new Vec4(0, 0, 0, 0);\n}\n\nexport interface FSRPassConfigs {\n    enableFSR: boolean;\n}\n\nexport class BuiltinFsrPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 500;\n    }\n    configCamera(\n        camera: Readonly<renderer.scene.Camera>,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs): void {\n        // FSR (Depend on Shading scale)\n        cameraConfigs.enableFSR = cameraConfigs.settings.fsr.enabled\n            && !!cameraConfigs.settings.fsr.material\n            && cameraConfigs.enableShadingScale\n            && cameraConfigs.shadingScale < 1.0;\n\n        if (cameraConfigs.enableFSR) {\n            ++cameraConfigs.remainingPasses;\n        }\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        if (!cameraConfigs.enableFSR) {\n            return prevRenderPass;\n        }\n        --cameraConfigs.remainingPasses;\n\n        const inputColorName = context.colorName;\n        const outputColorName\n            = cameraConfigs.remainingPasses === 0\n                ? cameraConfigs.colorName\n                : getPingPongRenderTarget(context.colorName, 'UiColor', cameraConfigs.renderWindowId);\n        context.colorName = outputColorName;\n\n        assert(!!cameraConfigs.settings.fsr.material);\n        return this._addFsrPass(ppl, pplConfigs, cameraConfigs,\n            cameraConfigs.settings,\n            cameraConfigs.settings.fsr.material,\n            cameraConfigs.renderWindowId,\n            cameraConfigs.width,\n            cameraConfigs.height,\n            inputColorName,\n            cameraConfigs.nativeWidth,\n            cameraConfigs.nativeHeight,\n            outputColorName);\n    }\n    private _addFsrPass(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        settings: PipelineSettings,\n        fsrMaterial: Material,\n        id: number,\n        width: number,\n        height: number,\n        inputColorName: string,\n        nativeWidth: number,\n        nativeHeight: number,\n        outputColorName: string,\n    ): rendering.BasicRenderPassBuilder {\n        this._fsrTexSize.x = width;\n        this._fsrTexSize.y = height;\n        this._fsrTexSize.z = nativeWidth;\n        this._fsrTexSize.w = nativeHeight;\n        this._fsrParams.x = clamp(1.0 - settings.fsr.sharpness, 0.02, 0.98);\n\n        const uiColorPrefix = 'UiColor';\n\n        const fsrColorName = getPingPongRenderTarget(outputColorName, uiColorPrefix, id);\n\n        const easuPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-easu');\n        easuPass.addRenderTarget(fsrColorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        easuPass.addTexture(inputColorName, 'outputResultMap');\n        easuPass.setVec4('fsrTexSize', this._fsrTexSize);\n        easuPass\n            .addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fsrMaterial, 0);\n\n        const rcasPass = ppl.addRenderPass(nativeWidth, nativeHeight, 'cc-fsr-rcas');\n        rcasPass.addRenderTarget(outputColorName, LoadOp.CLEAR, StoreOp.STORE, sClearColorTransparentBlack);\n        rcasPass.addTexture(fsrColorName, 'outputResultMap');\n        rcasPass.setVec4('fsrTexSize', this._fsrTexSize);\n        rcasPass.setVec4('fsrParams', this._fsrParams);\n        rcasPass\n            .addQueue(rendering.QueueHint.OPAQUE)\n            .addFullscreenQuad(fsrMaterial, 1);\n\n        return rcasPass;\n    }\n    // FSR\n    private readonly _fsrParams = new Vec4(0, 0, 0, 0);\n    private readonly _fsrTexSize = new Vec4(0, 0, 0, 0);\n}\n\nexport class BuiltinUiPassBuilder implements rendering.PipelinePassBuilder {\n    getConfigOrder(): number {\n        return 0;\n    }\n    getRenderOrder(): number {\n        return 1000;\n    }\n    setup(\n        ppl: rendering.BasicPipeline,\n        pplConfigs: Readonly<PipelineConfigs>,\n        cameraConfigs: CameraConfigs & FSRPassConfigs,\n        camera: renderer.scene.Camera,\n        context: PipelineContext,\n        prevRenderPass?: rendering.BasicRenderPassBuilder)\n        : rendering.BasicRenderPassBuilder | undefined {\n        assert(!!prevRenderPass);\n\n        let flags = rendering.SceneFlags.UI;\n        if (cameraConfigs.enableProfiler) {\n            flags |= rendering.SceneFlags.PROFILER;\n            prevRenderPass.showStatistics = true;\n        }\n        prevRenderPass\n            .addQueue(rendering.QueueHint.BLEND, 'default', 'default')\n            .addScene(camera, flags);\n\n        return prevRenderPass;\n    }\n}\n\nif (rendering) {\n\n    const { QueueHint, SceneFlags } = rendering;\n\n    class BuiltinPipelineBuilder implements rendering.PipelineBuilder {\n        private readonly _pipelineEvent: PipelineEventProcessor = cclegacy.director.root.pipelineEvent as PipelineEventProcessor;\n        private readonly _forwardPass = new BuiltinForwardPassBuilder();\n        private readonly _bloomPass = new BuiltinBloomPassBuilder();\n        private readonly _toneMappingPass = new BuiltinToneMappingPassBuilder();\n        private readonly _fxaaPass = new BuiltinFXAAPassBuilder();\n        private readonly _fsrPass = new BuiltinFsrPassBuilder();\n        private readonly _uiPass = new BuiltinUiPassBuilder();\n        // Internal cached resources\n        private readonly _clearColor = new Color(0, 0, 0, 1);\n        private readonly _viewport = new Viewport();\n        private readonly _configs = new PipelineConfigs();\n        private readonly _cameraConfigs = new CameraConfigs();\n        // Materials\n        private readonly _copyAndTonemapMaterial = new Material();\n\n        // Internal States\n        private _initialized = false; // TODO(zhouzhenglong): Make default effect asset loading earlier and remove this flag\n        private _passBuilders: rendering.PipelinePassBuilder[] = [];\n\n        private _setupPipelinePreview(\n            camera: renderer.scene.Camera,\n            cameraConfigs: CameraConfigs) {\n            const isEditorView: boolean\n                = camera.cameraUsage === CameraUsage.SCENE_VIEW\n                || camera.cameraUsage === CameraUsage.PREVIEW;\n\n            if (isEditorView) {\n                const editorSettings = rendering.getEditorPipelineSettings() as PipelineSettings | null;\n                if (editorSettings) {\n                    cameraConfigs.settings = editorSettings;\n                } else {\n                    cameraConfigs.settings = defaultSettings;\n                }\n            } else {\n                if (camera.pipelineSettings) {\n                    cameraConfigs.settings = camera.pipelineSettings as PipelineSettings;\n                } else {\n                    cameraConfigs.settings = defaultSettings;\n                }\n            }\n        }\n\n        private _preparePipelinePasses(cameraConfigs: CameraConfigs): void {\n            const passBuilders = this._passBuilders;\n            passBuilders.length = 0;\n\n            const settings = cameraConfigs.settings as PipelineSettings2;\n            if (settings._passes) {\n                for (const pass of settings._passes) {\n                    passBuilders.push(pass);\n                }\n                assert(passBuilders.length === settings._passes.length);\n            }\n\n            passBuilders.push(this._forwardPass);\n\n            if (settings.bloom.enabled) {\n                passBuilders.push(this._bloomPass);\n            }\n\n            passBuilders.push(this._toneMappingPass);\n\n            if (settings.fxaa.enabled) {\n                passBuilders.push(this._fxaaPass);\n            }\n\n            if (settings.fsr.enabled) {\n                passBuilders.push(this._fsrPass);\n            }\n            passBuilders.push(this._uiPass);\n        }\n\n        private _setupBuiltinCameraConfigs(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            pipelineConfigs: PipelineConfigs,\n            cameraConfigs: CameraConfigs\n        ) {\n            const window = camera.window;\n            const isMainGameWindow: boolean = camera.cameraUsage === CameraUsage.GAME && !!window.swapchain;\n            const isGameView = isMainGameWindow || camera.cameraUsage === CameraUsage.GAME_VIEW;\n\n            // Window\n            cameraConfigs.isMainGameWindow = isMainGameWindow;\n            cameraConfigs.renderWindowId = window.renderWindowId;\n\n            // Camera\n            cameraConfigs.colorName = window.colorName;\n            cameraConfigs.depthStencilName = window.depthStencilName;\n\n            // Pipeline\n            cameraConfigs.enableFullPipeline = (camera.visibility & (Layers.Enum.DEFAULT)) !== 0;\n            cameraConfigs.enableProfiler = ppl.profiler && isGameView;\n            cameraConfigs.remainingPasses = 0;\n\n            // Shading scale\n            cameraConfigs.shadingScale = cameraConfigs.settings.shadingScale;\n            cameraConfigs.enableShadingScale = cameraConfigs.settings.enableShadingScale\n                && cameraConfigs.shadingScale !== 1.0;\n\n            cameraConfigs.nativeWidth = Math.max(Math.floor(window.width), 1);\n            cameraConfigs.nativeHeight = Math.max(Math.floor(window.height), 1);\n\n            cameraConfigs.width = cameraConfigs.enableShadingScale\n                ? Math.max(Math.floor(cameraConfigs.nativeWidth * cameraConfigs.shadingScale), 1)\n                : cameraConfigs.nativeWidth;\n            cameraConfigs.height = cameraConfigs.enableShadingScale\n                ? Math.max(Math.floor(cameraConfigs.nativeHeight * cameraConfigs.shadingScale), 1)\n                : cameraConfigs.nativeHeight;\n\n            // Radiance\n            cameraConfigs.enableHDR = cameraConfigs.enableFullPipeline\n                && pipelineConfigs.useFloatOutput;\n            cameraConfigs.radianceFormat = cameraConfigs.enableHDR\n                ? gfx.Format.RGBA16F : gfx.Format.RGBA8;\n\n            // Tone Mapping\n            cameraConfigs.copyAndTonemapMaterial = this._copyAndTonemapMaterial;\n\n            // Depth\n            cameraConfigs.enableStoreSceneDepth = false;\n        }\n\n        private _setupCameraConfigs(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            pipelineConfigs: PipelineConfigs,\n            cameraConfigs: CameraConfigs\n        ): void {\n            this._setupPipelinePreview(camera, cameraConfigs);\n\n            this._preparePipelinePasses(cameraConfigs);\n\n            sortPipelinePassBuildersByConfigOrder(this._passBuilders);\n\n            this._setupBuiltinCameraConfigs(ppl, camera, pipelineConfigs, cameraConfigs);\n\n            for (const builder of this._passBuilders) {\n                if (builder.configCamera) {\n                    builder.configCamera(camera, pipelineConfigs, cameraConfigs);\n                }\n            }\n        }\n\n        // ----------------------------------------------------------------\n        // Interface\n        // ----------------------------------------------------------------\n        windowResize(\n            ppl: rendering.BasicPipeline,\n            window: renderer.RenderWindow,\n            camera: renderer.scene.Camera,\n            nativeWidth: number,\n            nativeHeight: number,\n        ): void {\n            setupPipelineConfigs(ppl, this._configs);\n\n            this._setupCameraConfigs(ppl, camera, this._configs, this._cameraConfigs);\n\n            // Render Window (UI)\n            const id = window.renderWindowId;\n\n            ppl.addRenderWindow(this._cameraConfigs.colorName,\n                Format.RGBA8, nativeWidth, nativeHeight, window,\n                this._cameraConfigs.depthStencilName);\n\n            const width = this._cameraConfigs.width;\n            const height = this._cameraConfigs.height;\n\n            if (this._cameraConfigs.enableShadingScale) {\n                ppl.addDepthStencil(`ScaledSceneDepth_${id}`, Format.DEPTH_STENCIL, width, height);\n                ppl.addRenderTarget(`ScaledRadiance0_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`ScaledRadiance1_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`ScaledLdrColor0_${id}`, Format.RGBA8, width, height);\n                ppl.addRenderTarget(`ScaledLdrColor1_${id}`, Format.RGBA8, width, height);\n            } else {\n                ppl.addDepthStencil(`SceneDepth_${id}`, Format.DEPTH_STENCIL, width, height);\n                ppl.addRenderTarget(`Radiance0_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`Radiance1_${id}`, this._cameraConfigs.radianceFormat, width, height);\n                ppl.addRenderTarget(`LdrColor0_${id}`, Format.RGBA8, width, height);\n                ppl.addRenderTarget(`LdrColor1_${id}`, Format.RGBA8, width, height);\n            }\n            ppl.addRenderTarget(`UiColor0_${id}`, Format.RGBA8, nativeWidth, nativeHeight);\n            ppl.addRenderTarget(`UiColor1_${id}`, Format.RGBA8, nativeWidth, nativeHeight);\n\n            for (const builder of this._passBuilders) {\n                if (builder.windowResize) {\n                    builder.windowResize(ppl, this._configs, this._cameraConfigs, window, camera, nativeWidth, nativeHeight);\n                }\n            }\n        }\n        setup(cameras: renderer.scene.Camera[], ppl: rendering.BasicPipeline): void {\n            // TODO(zhouzhenglong): Make default effect asset loading earlier and remove _initMaterials\n            if (this._initMaterials(ppl)) {\n                return;\n            }\n\n            // Render cameras\n            // log(`==================== One Frame ====================`);\n            for (const camera of cameras) {\n                // Skip invalid camera\n                if (!camera.scene || !camera.window) {\n                    continue;\n                }\n                // Setup camera configs\n                this._setupCameraConfigs(ppl, camera, this._configs, this._cameraConfigs);\n                // log(`Setup camera: ${camera.node!.name}, window: ${camera.window.renderWindowId}, isFull: ${this._cameraConfigs.enableFullPipeline}, `\n                //     + `size: ${camera.window.width}x${camera.window.height}`);\n\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_BEGIN, camera);\n\n                // Build pipeline\n                if (this._cameraConfigs.enableFullPipeline) {\n                    this._buildForwardPipeline(ppl, camera, camera.scene, this._passBuilders);\n                } else {\n                    this._buildSimplePipeline(ppl, camera);\n                }\n\n                this._pipelineEvent.emit(PipelineEventType.RENDER_CAMERA_END, camera);\n            }\n        }\n        // ----------------------------------------------------------------\n        // Pipelines\n        // ----------------------------------------------------------------\n        private _buildSimplePipeline(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n        ): void {\n            const width = Math.max(Math.floor(camera.window.width), 1);\n            const height = Math.max(Math.floor(camera.window.height), 1);\n            const colorName = this._cameraConfigs.colorName;\n            const depthStencilName = this._cameraConfigs.depthStencilName;\n\n            const viewport = camera.viewport;  // Reduce C++/TS interop\n            this._viewport.left = Math.round(viewport.x * width);\n            this._viewport.top = Math.round(viewport.y * height);\n            // Here we must use camera.viewport.width instead of camera.viewport.z, which\n            // is undefined on native platform. The same as camera.viewport.height.\n            this._viewport.width = Math.max(Math.round(viewport.width * width), 1);\n            this._viewport.height = Math.max(Math.round(viewport.height * height), 1);\n\n            const clearColor = camera.clearColor;  // Reduce C++/TS interop\n            this._clearColor.x = clearColor.x;\n            this._clearColor.y = clearColor.y;\n            this._clearColor.z = clearColor.z;\n            this._clearColor.w = clearColor.w;\n\n            const pass = ppl.addRenderPass(width, height, 'default');\n\n            // bind output render target\n            if (forwardNeedClearColor(camera)) {\n                pass.addRenderTarget(colorName, LoadOp.CLEAR, StoreOp.STORE, this._clearColor);\n            } else {\n                pass.addRenderTarget(colorName, LoadOp.LOAD, StoreOp.STORE);\n            }\n\n            // bind depth stencil buffer\n            if (camera.clearFlag & ClearFlagBit.DEPTH_STENCIL) {\n                pass.addDepthStencil(\n                    depthStencilName,\n                    LoadOp.CLEAR,\n                    StoreOp.DISCARD,\n                    camera.clearDepth,\n                    camera.clearStencil,\n                    camera.clearFlag & ClearFlagBit.DEPTH_STENCIL,\n                );\n            } else {\n                pass.addDepthStencil(depthStencilName, LoadOp.LOAD, StoreOp.DISCARD);\n            }\n\n            pass.setViewport(this._viewport);\n\n            // The opaque queue is used for Reflection probe preview\n            pass.addQueue(QueueHint.OPAQUE)\n                .addScene(camera, SceneFlags.OPAQUE);\n\n            // The blend queue is used for UI and Gizmos\n            let flags = SceneFlags.BLEND | SceneFlags.UI;\n            if (this._cameraConfigs.enableProfiler) {\n                flags |= SceneFlags.PROFILER;\n                pass.showStatistics = true;\n            }\n            pass.addQueue(QueueHint.BLEND)\n                .addScene(camera, flags);\n        }\n\n        private _buildForwardPipeline(\n            ppl: rendering.BasicPipeline,\n            camera: renderer.scene.Camera,\n            scene: renderer.RenderScene,\n            passBuilders: rendering.PipelinePassBuilder[],\n        ): void {\n            sortPipelinePassBuildersByRenderOrder(passBuilders);\n\n            const context: PipelineContext = {\n                colorName: '',\n                depthStencilName: '',\n            };\n\n            let lastPass: rendering.BasicRenderPassBuilder | undefined = undefined;\n\n            for (const builder of passBuilders) {\n                if (builder.setup) {\n                    lastPass = builder.setup(ppl, this._configs, this._cameraConfigs,\n                        camera, context, lastPass);\n                }\n            }\n\n            assert(this._cameraConfigs.remainingPasses === 0);\n        }\n\n        private _initMaterials(ppl: rendering.BasicPipeline): number {\n            if (this._initialized) {\n                return 0;\n            }\n\n            setupPipelineConfigs(ppl, this._configs);\n\n            // When add new effect asset, please add its uuid to the dependentAssets in cc.config.json.\n            this._copyAndTonemapMaterial._uuid = `builtin-pipeline-tone-mapping-material`;\n            this._copyAndTonemapMaterial.initialize({ effectName: 'pipeline/post-process/tone-mapping' });\n\n            if (this._copyAndTonemapMaterial.effectAsset) {\n                this._initialized = true;\n            }\n\n            return this._initialized ? 0 : 1;\n        }\n    }\n\n    rendering.setCustomPipeline('Builtin', new BuiltinPipelineBuilder());\n\n} // if (rendering)\n"]}